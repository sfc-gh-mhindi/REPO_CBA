-- FRAUMD Warehouse Analysis Queries
-- Filtered for specific FRAUMD warehouses
call pst.svcs.sp_set_account_context (50973,'AU');
USE DATABASE PST;
USE SCHEMA PST.SVCS;


SELECT

	QUERY_TYPE,

SUM(CASE WHEN TOTAL_ELAPSED_TIME < 1000 THEN 1 ELSE 0 END) AS BT_0_1,
SUM(CASE WHEN TOTAL_ELAPSED_TIME < 5000 AND TOTAL_ELAPSED_TIME >= 1000 THEN 1 ELSE 0 END) AS BT_1_5,
SUM(CASE WHEN TOTAL_ELAPSED_TIME < 10000 AND TOTAL_ELAPSED_TIME >= 5000 THEN 1 ELSE 0 END) AS BT_5_10,
SUM(CASE WHEN TOTAL_ELAPSED_TIME < 30000 AND TOTAL_ELAPSED_TIME >= 10000 THEN 1 ELSE 0 END) AS BT_10_30,
SUM(CASE WHEN TOTAL_ELAPSED_TIME < 60000 AND TOTAL_ELAPSED_TIME >= 30000 THEN 1 ELSE 0 END) AS BT_30_60,
SUM(CASE WHEN TOTAL_ELAPSED_TIME < 90000 AND TOTAL_ELAPSED_TIME >= 60000 THEN 1 ELSE 0 END) AS BT_60_90,
SUM(CASE WHEN TOTAL_ELAPSED_TIME >= 90000 THEN 1 ELSE 0 END) AS GTE_90

FROM
    query_history
WHERE warehouse_name IN ('WH_USR_PRD_P01_FRAUMD_001', 'WH_USR_PRD_P01_FRAUMD_LABMLFRD_001', 'WH_USR_PRD_P01_FRAUMD_LABMLFRD_002', 'WH_USR_PRD_P01_FRAUMD_LABMLFRD_003') AND
    START_TIME >= dateadd(MONTH,-1,CURRENT_DATE())
GROUP BY
    ALL
ORDER BY
    GTE_90 DESC
;