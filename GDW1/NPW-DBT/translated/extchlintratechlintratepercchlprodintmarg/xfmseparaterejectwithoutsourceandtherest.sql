{{ config(materialized='view', tags=['ExtChlIntRateChlIntRatePercChlProdIntMarg']) }}

WITH XfmSeparateRejectWithoutSourceAndTheRest AS (
	SELECT
		-- *SRC*: \(20)If (Len(Trim(( IF IsNotNull((XfmSeparateRejects.HL_INT_RATE_ID)) THEN (XfmSeparateRejects.HL_INT_RATE_ID) ELSE ""))) = 0) Then 'R' Else 'S',
		IFF(LEN(TRIM(IFF({{ ref('JoinSrcSortReject') }}.HL_INT_RATE_ID IS NOT NULL, {{ ref('JoinSrcSortReject') }}.HL_INT_RATE_ID, ''))) = 0, 'R', 'S') AS DeltaFlag,
		-- *SRC*: \(20)If DeltaFlag = 'S' Then XfmSeparateRejects.HL_INT_RATE_ID Else XfmSeparateRejects.HL_INT_RATE_ID_R,
		IFF(DeltaFlag = 'S', {{ ref('JoinSrcSortReject') }}.HL_INT_RATE_ID, {{ ref('JoinSrcSortReject') }}.HL_INT_RATE_ID_R) AS HL_INT_RATE_ID,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.RATE_FOUND_FLAG)) THEN (XfmSeparateRejects.RATE_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.RATE_HL_INT_RATE_ID Else XfmSeparateRejects.RATE_HL_INT_RATE_ID_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.RATE_HL_INT_RATE_ID, {{ ref('JoinSrcSortReject') }}.RATE_HL_INT_RATE_ID_R) AS RATE_HL_INT_RATE_ID,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.RATE_FOUND_FLAG)) THEN (XfmSeparateRejects.RATE_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.RATE_HL_APP_PROD_ID Else XfmSeparateRejects.RATE_HL_APP_PROD_ID_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.RATE_HL_APP_PROD_ID, {{ ref('JoinSrcSortReject') }}.RATE_HL_APP_PROD_ID_R) AS RATE_HL_APP_PROD_ID,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.RATE_FOUND_FLAG)) THEN (XfmSeparateRejects.RATE_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.RATE_CASS_INT_RATE_TYPE_CODE Else XfmSeparateRejects.RATE_CASS_INT_RATE_TYPE_CODE_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.RATE_CASS_INT_RATE_TYPE_CODE, {{ ref('JoinSrcSortReject') }}.RATE_CASS_INT_RATE_TYPE_CODE_R) AS RATE_CASS_INT_RATE_TYPE_CODE,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.RATE_FOUND_FLAG)) THEN (XfmSeparateRejects.RATE_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.RATE_RATE_SEQUENCE Else XfmSeparateRejects.RATE_RATE_SEQUENCE_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.RATE_RATE_SEQUENCE, {{ ref('JoinSrcSortReject') }}.RATE_RATE_SEQUENCE_R) AS RATE_RATE_SEQUENCE,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.RATE_FOUND_FLAG)) THEN (XfmSeparateRejects.RATE_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.RATE_DURATION Else XfmSeparateRejects.RATE_DURATION_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.RATE_DURATION, {{ ref('JoinSrcSortReject') }}.RATE_DURATION_R) AS RATE_DURATION,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.PERC_FOUND_FLAG)) THEN (XfmSeparateRejects.PERC_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.PERC_HL_INT_RATE_ID Else XfmSeparateRejects.PERC_HL_INT_RATE_ID_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.PERC_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.PERC_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.PERC_HL_INT_RATE_ID, {{ ref('JoinSrcSortReject') }}.PERC_HL_INT_RATE_ID_R) AS PERC_HL_INT_RATE_ID,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.PERC_FOUND_FLAG)) THEN (XfmSeparateRejects.PERC_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.PERC_SCHEDULE_RATE_TYPE Else XfmSeparateRejects.PERC_SCHEDULE_RATE_TYPE_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.PERC_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.PERC_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.PERC_SCHEDULE_RATE_TYPE, {{ ref('JoinSrcSortReject') }}.PERC_SCHEDULE_RATE_TYPE_R) AS PERC_SCHEDULE_RATE_TYPE,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.PERC_FOUND_FLAG)) THEN (XfmSeparateRejects.PERC_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.PERC_RATE_PERCENT_1 Else XfmSeparateRejects.PERC_RATE_PERCENT_1_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.PERC_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.PERC_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.PERC_RATE_PERCENT_1, {{ ref('JoinSrcSortReject') }}.PERC_RATE_PERCENT_1_R) AS PERC_RATE_PERCENT_1,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.PERC_FOUND_FLAG)) THEN (XfmSeparateRejects.PERC_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.PERC_RATE_PERCENT_2 Else XfmSeparateRejects.PERC_RATE_PERCENT_2_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.PERC_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.PERC_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.PERC_RATE_PERCENT_2, {{ ref('JoinSrcSortReject') }}.PERC_RATE_PERCENT_2_R) AS PERC_RATE_PERCENT_2,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.MARG_FOUND_FLAG)) THEN (XfmSeparateRejects.MARG_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.MARG_HL_PROD_INT_MARGIN_ID Else XfmSeparateRejects.MARG_HL_PROD_INT_MARGIN_ID_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.MARG_HL_PROD_INT_MARGIN_ID, {{ ref('JoinSrcSortReject') }}.MARG_HL_PROD_INT_MARGIN_ID_R) AS MARG_HL_PROD_INT_MARGIN_ID,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.MARG_FOUND_FLAG)) THEN (XfmSeparateRejects.MARG_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.MARG_HL_INT_RATE_ID Else XfmSeparateRejects.MARG_HL_INT_RATE_ID_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.MARG_HL_INT_RATE_ID, {{ ref('JoinSrcSortReject') }}.MARG_HL_INT_RATE_ID_R) AS MARG_HL_INT_RATE_ID,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.MARG_FOUND_FLAG)) THEN (XfmSeparateRejects.MARG_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.MARG_HL_PROD_INT_MARGIN_CAT_ID Else XfmSeparateRejects.MARG_HL_PROD_INT_MARGIN_CAT_ID_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.MARG_HL_PROD_INT_MARGIN_CAT_ID, {{ ref('JoinSrcSortReject') }}.MARG_HL_PROD_INT_MARGIN_CAT_ID_R) AS MARG_HL_PROD_INT_MARGIN_CAT_ID,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.MARG_FOUND_FLAG)) THEN (XfmSeparateRejects.MARG_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.MARG_MARGIN_TYPE Else XfmSeparateRejects.MARG_MARGIN_TYPE_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.MARG_MARGIN_TYPE, {{ ref('JoinSrcSortReject') }}.MARG_MARGIN_TYPE_R) AS MARG_MARGIN_TYPE,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.MARG_FOUND_FLAG)) THEN (XfmSeparateRejects.MARG_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.MARG_MARGIN_DESC Else XfmSeparateRejects.MARG_MARGIN_DESC_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.MARG_MARGIN_DESC, {{ ref('JoinSrcSortReject') }}.MARG_MARGIN_DESC_R) AS MARG_MARGIN_DESC,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.MARG_FOUND_FLAG)) THEN (XfmSeparateRejects.MARG_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.MARG_MARGIN_CODE Else XfmSeparateRejects.MARG_MARGIN_CODE_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.MARG_MARGIN_CODE, {{ ref('JoinSrcSortReject') }}.MARG_MARGIN_CODE_R) AS MARG_MARGIN_CODE,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.MARG_FOUND_FLAG)) THEN (XfmSeparateRejects.MARG_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.MARG_MARGIN_AMOUNT Else XfmSeparateRejects.MARG_MARGIN_AMOUNT_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.MARG_MARGIN_AMOUNT, {{ ref('JoinSrcSortReject') }}.MARG_MARGIN_AMOUNT_R) AS MARG_MARGIN_AMOUNT,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.MARG_FOUND_FLAG)) THEN (XfmSeparateRejects.MARG_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.MARG_ADJ_AMT Else XfmSeparateRejects.MARG_ADJ_AMT_R,
		IFF(IFF({{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.MARG_ADJ_AMT, {{ ref('JoinSrcSortReject') }}.MARG_ADJ_AMT_R) AS MARG_ADJ_AMT,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.RATE_FOUND_FLAG)) THEN (XfmSeparateRejects.RATE_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.RATE_FOUND_FLAG Else  If ( IF IsNotNull((XfmSeparateRejects.RATE_FOUND_FLAG_R)) THEN (XfmSeparateRejects.RATE_FOUND_FLAG_R) ELSE "") = 'Y' Then XfmSeparateRejects.RATE_FOUND_FLAG_R Else 'N',
		IFF(IFF({{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG, IFF(IFF({{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG_R IS NOT NULL, {{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG_R, '') = 'Y', {{ ref('JoinSrcSortReject') }}.RATE_FOUND_FLAG_R, 'N')) AS RATE_FOUND_FLAG,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.PERC_FOUND_FLAG)) THEN (XfmSeparateRejects.PERC_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.PERC_FOUND_FLAG Else  If ( IF IsNotNull((XfmSeparateRejects.PERC_FOUND_FLAG_R)) THEN (XfmSeparateRejects.PERC_FOUND_FLAG_R) ELSE "") = 'Y' Then XfmSeparateRejects.PERC_FOUND_FLAG_R Else 'N',
		IFF(IFF({{ ref('JoinSrcSortReject') }}.PERC_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.PERC_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.PERC_FOUND_FLAG, IFF(IFF({{ ref('JoinSrcSortReject') }}.PERC_FOUND_FLAG_R IS NOT NULL, {{ ref('JoinSrcSortReject') }}.PERC_FOUND_FLAG_R, '') = 'Y', {{ ref('JoinSrcSortReject') }}.PERC_FOUND_FLAG_R, 'N')) AS PERC_FOUND_FLAG,
		-- *SRC*: \(20)If ( IF IsNotNull((XfmSeparateRejects.MARG_FOUND_FLAG)) THEN (XfmSeparateRejects.MARG_FOUND_FLAG) ELSE "") = 'Y' Then XfmSeparateRejects.MARG_FOUND_FLAG Else  If ( IF IsNotNull((XfmSeparateRejects.MARG_FOUND_FLAG_R)) THEN (XfmSeparateRejects.MARG_FOUND_FLAG_R) ELSE "") = 'Y' Then XfmSeparateRejects.MARG_FOUND_FLAG_R Else 'N',
		IFF(IFF({{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG IS NOT NULL, {{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG, '') = 'Y', {{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG, IFF(IFF({{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG_R IS NOT NULL, {{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG_R, '') = 'Y', {{ ref('JoinSrcSortReject') }}.MARG_FOUND_FLAG_R, 'N')) AS MARG_FOUND_FLAG,
		-- *SRC*: \(20)If Len(Trim(( IF IsNotNull((XfmSeparateRejects.ORIG_ETL_D_R)) THEN (XfmSeparateRejects.ORIG_ETL_D_R) ELSE ""))) = 0 Then ETL_PROCESS_DT Else XfmSeparateRejects.ORIG_ETL_D_R,
		IFF(LEN(TRIM(IFF({{ ref('JoinSrcSortReject') }}.ORIG_ETL_D_R IS NOT NULL, {{ ref('JoinSrcSortReject') }}.ORIG_ETL_D_R, ''))) = 0, ETL_PROCESS_DT, {{ ref('JoinSrcSortReject') }}.ORIG_ETL_D_R) AS ORIG_ETL_D
	FROM {{ ref('JoinSrcSortReject') }}
	WHERE 
)

SELECT * FROM XfmSeparateRejectWithoutSourceAndTheRest