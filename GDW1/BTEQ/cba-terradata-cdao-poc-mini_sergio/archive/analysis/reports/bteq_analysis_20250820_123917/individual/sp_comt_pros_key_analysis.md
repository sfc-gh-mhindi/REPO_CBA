# sp_comt_pros_key.sql - BTEQ Analysis

## File Overview
- **File Name**: sp_comt_pros_key.sql
- **Analysis Status**: ‚úÖ Success
- **Control Statements**: 8
- **SQL Blocks**: 1

## Control Flow Analysis

| Line | Type | Statement |
|------|------|-----------|
| 1 | RUN | `.RUN FILE=%%BTEQ_LOGON_SCRIPT%%` |
| 2 | IF_ERRORCODE | `.IF ERRORCODE <> 0    THEN .GOTO EXITERR` |
| 23 | IMPORT | `.IMPORT VARTEXT FILE=/cba_app/CBMGDW/%%ENV_C%%/schedule/%%STRM_C%%_%%TBSHORT%%PR...` |
| 41 | EXPORT | `.EXPORT RESET` |
| 43 | IF_ERRORCODE | `.IF ERRORCODE <> 0    THEN .GOTO EXITERR` |
| 46 | LOGOFF | `.LOGOFF` |
| 48 | LABEL | `.LABEL EXITERR` |
| 50 | LOGOFF | `.LOGOFF` |

## SQL Blocks Analysis

### SQL Block 1 (Lines 28-40)
- **Complexity Score**: 54
- **Has Valid SQL**: ‚úÖ
- **Conversion Successful**: ‚úÖ
- **Syntax Validation**: ‚úÖ Valid
- **Teradata Features**: 1

#### üìù Original Teradata SQL:
```sql
UPDATE %%STARDATADB%%.UTIL_PROS_ISAC           
SET
   SUCC_F  = 'Y'
  ,COMT_F = 'Y'
  ,COMT_S = CAST(CAST(current_timestamp as CHAR(20)) as TIMESTAMP(0))
WHERE
  PROS_KEY_I = CAST(trim(:PROS_KEY) as DECIMAL(10,0)) 
  AND SRCE_SYST_M = '%%SRCE_M%%'
  AND TRGT_M = '%%PSST_TABLE_M%%'
  AND BTCH_RUN_D = CAST(%%INDATE%% as DATE FORMAT'YYYYMMDD')
;
```

#### ‚ùÑÔ∏è Converted Snowflake SQL:
```sql
UPDATE %%STARDATADB%%.UTIL_PROS_ISAC SET SUCC_F = 'Y', COMT_F = 'Y', COMT_S = CAST(CAST(CURRENT_TIMESTAMP() AS CHAR(20)) AS TIMESTAMP(0)) WHERE PROS_KEY_I = CAST(TRIM(:PROS_KEY) AS DECIMAL(10, 0)) AND SRCE_SYST_M = '%%SRCE_M%%' AND TRGT_M = '%%PSST_TABLE_M%%' AND BTCH_RUN_D = DATE(%%INDATE%%, 'yyyymmDD')
```

#### üîç Syntax Validation Details:
- **Valid**: ‚úÖ

#### üéØ Teradata Features Detected:
- Variable substitution

#### ‚ö° Optimized SQL:
```sql
UPDATE "%%stardatadb%%"."util_pros_isac" SET "succ_f" = 'Y', "comt_f" = 'Y', "comt_s" = CAST(CAST(CURRENT_TIMESTAMP() AS CHAR(20)) AS TIMESTAMP(0))
WHERE
  "btch_run_d" = DATE("%%indate%%", 'yyyymmDD')
  AND "pros_key_i" = CAST(TRIM(:PROS_KEY) AS DECIMAL(10, 0))
  AND "srce_syst_m" = '%%SRCE_M%%'
  AND "trgt_m" = '%%PSST_TABLE_M%%'
```

#### üìä SQL Metadata:
- **Tables**: UTIL_PROS_ISAC
- **Columns**: %%INDATE%%, BTCH_RUN_D, COMT_F, COMT_S, PROS_KEY_I, SRCE_SYST_M, SUCC_F, TRGT_M
- **Functions**: %%INDATE%%, :PROS_KEY, CAST(CURRENT_TIMESTAMP() AS CHAR(20)), CURRENT_TIMESTAMP(), None, PROS_KEY_I = CAST(TRIM(:PROS_KEY) AS DECIMAL(10, 0)), PROS_KEY_I = CAST(TRIM(:PROS_KEY) AS DECIMAL(10, 0)) AND SRCE_SYST_M = '%%SRCE_M%%', PROS_KEY_I = CAST(TRIM(:PROS_KEY) AS DECIMAL(10, 0)) AND SRCE_SYST_M = '%%SRCE_M%%' AND TRGT_M = '%%PSST_TABLE_M%%', TRIM(:PROS_KEY)

## Migration Recommendations

### Suggested Migration Strategy
**Medium complexity** - Incremental model with DCF hooks recommended

### DCF Mapping
- **Error Handling**: Convert `.IF ERRORCODE` patterns to DCF error handling macros
- **File Operations**: Replace IMPORT/EXPORT with dbt seeds or external tables
- **Statistics**: Replace COLLECT STATS with Snowflake post-hooks
- **Stored Procedures**: Map CALL statements to DCF stored procedure macros

---

*Generated by BTEQ Parser Service - 2025-08-20 12:39:23*
