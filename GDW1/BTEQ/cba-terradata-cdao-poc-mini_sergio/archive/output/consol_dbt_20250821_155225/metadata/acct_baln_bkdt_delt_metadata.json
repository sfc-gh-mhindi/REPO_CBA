{
  "success": false,
  "quality_score": 1.0,
  "model_sql": "{%- set process_name = 'ACCT_BALN_BKDT_DELT' -%}\n{%- set stream_name = 'ACCT_BALN_BKDT' -%}\n\n{{\n  config(\n    materialized='table',\n    database=var('cad_prod_data_db'),\n    schema='acct_baln',\n    tags=['account_balance', 'delete_operation', 'staging'],\n    pre_hook=[\n        \"{{ log_dcf_exec_msg('ACCT_BALN_BKDT_DELT Process started - Deleting modified records from ACCT_BALN_BKDT') }}\"\n    ],\n    post_hook=[\n        \"{{ log_dcf_exec_msg('ACCT_BALN_BKDT_DELT Process ended - Records deleted successfully') }}\"\n    ]\n  )\n}}\n\n/*\n    Model: acct_baln_bkdt_delt\n    Purpose: Delete accounts from ACCT_BALN_BKDT so that modified data can be inserted in next step\n    Business Logic: Removes records that have been modified as a result of applying adjustments\n                   These records will be reinserted from STG2 in the next step\n    Dependencies: \n        - ACCT_BALN_BKDT (target table for deletion)\n        - ACCT_BALN_BKDT_STG1 (staging table with modified records)\n    \n    Version: 1.0\n    Created: 2011-10-05 by Suresh Vajapeyajula\n    Converted to DBT: DELETE operation converted to table materialization\n*/\n\nWITH records_to_keep AS (\n    -- Select records from ACCT_BALN_BKDT that should NOT be deleted\n    -- (i.e., records that don't match the staging criteria)\n    SELECT \n        bal.ACCT_I,\n        bal.BALN_TYPE_C,\n        bal.CALC_FUNC_C,\n        bal.TIME_PERD_C,\n        bal.BKDT_EFFT_D,\n        bal.BKDT_EXPY_D,\n        bal.BALN_A,\n        bal.CALC_F,\n        bal.PROS_KEY_EFFT_I,\n        bal.PROS_KEY_EXPY_I\n    FROM {{ ref('acct_baln_bkdt') }} bal\n    LEFT JOIN {{ ref('acct_baln_bkdt_stg1') }} stg1\n        ON stg1.ACCT_I = bal.ACCT_I    \n        AND stg1.BALN_TYPE_C = bal.BALN_TYPE_C                    \n        AND stg1.CALC_FUNC_C = bal.CALC_FUNC_C                   \n        AND stg1.TIME_PERD_C = bal.TIME_PERD_C                   \n        AND stg1.BKDT_EFFT_D = bal.BKDT_EFFT_D                        \n        AND stg1.BKDT_EXPY_D = bal.BKDT_EXPY_D                        \n        AND stg1.BALN_A = bal.BALN_A                        \n        AND stg1.CALC_F = bal.CALC_F                        \n        AND COALESCE(stg1.PROS_KEY_EFFT_I, 0) = COALESCE(bal.PROS_KEY_EFFT_I, 0)\n        AND COALESCE(stg1.PROS_KEY_EXPY_I, 0) = COALESCE(bal.PROS_KEY_EXPY_I, 0)\n    WHERE stg1.ACCT_I IS NULL  -- Keep only records that don't match staging\n),\n\nfinal AS (\n    SELECT \n        ACCT_I,\n        BALN_TYPE_C,\n        CALC_FUNC_C,\n        TIME_PERD_C,\n        BKDT_EFFT_D,\n        BKDT_EXPY_D,\n        BALN_A,\n        CALC_F,\n        PROS_KEY_EFFT_I,\n        PROS_KEY_EXPY_I\n    FROM records_to_keep\n)\n\nSELECT * FROM final",
  "metadata": {
    "models_used": [
      "claude-4-sonnet",
      "snowflake-llama-3.3-70b"
    ],
    "preferred_model": "claude-4-sonnet",
    "quality_score": 1.0,
    "dbt_features": [
      "config",
      "variables",
      "references",
      "macros",
      "jinja_variables",
      "pre_hooks",
      "post_hooks",
      "tags"
    ],
    "total_time_ms": 21146,
    "comparison_notes": [
      "Selected claude-4-sonnet as preferred model",
      "claude-4-sonnet: Quality=1.000, Features=8, Time=13898ms",
      "snowflake-llama-3.3-70b: Quality=0.910, Features=8, Time=7238ms"
    ],
    "migration_notes": [
      "Organized logic using CTEs for better readability",
      "Added DBT configuration for materialization and metadata",
      "Used DBT variables for environment-specific configuration",
      "Converted from procedural BTEQ to declarative DBT model"
    ]
  },
  "warnings": [
    "Uses SELECT * - consider explicit column selection"
  ],
  "execution_time_ms": 21146
}