# LLM Response
Interaction ID: 20250821_155117_737f34ae
Success: True
Processing Time: 6883ms
Quality Score: None

# Response
```sql
{%- set process_name = 'ACCT_BALN_BKDT_UTIL_PROS_UPDT' -%}
{%- set stream_name = 'ACCT_BALN_BKDT_STREAM' -%}

{{
  config(
    materialized='table',
    database=var('CAD_PROD_DATA'),
    schema=var('CAD_PROD_SCHEMA'),
    tags=['ACCT_BALN_BKDT', 'UTIL_PROS_ISAC'],
    pre_hook=[
        "{{ log_dcf_exec_msg('ACCT_BALN_BKDT_UTIL_PROS_UPDT process started') }}"
    ],
    post_hook=[
        "{{ log_dcf_exec_msg('ACCT_BALN_BKDT_UTIL_PROS_UPDT process ended') }}"
    ]
  )
}}

/*
    Model Documentation
    Purpose: Update UTIL_PROS_ISAC with the status.
    Business Logic: Update COMT_F, SUCC_F, COMT_S, SYST_INS_Q, SYST_DEL_Q based on CONV_M and PROS_KEY_I.
    Dependencies: ACCT_BALN_BKDT_STG1, ACCT_BALN_BKDT_STG2, UTIL_PROS_ISAC
*/

WITH ins_cnt AS (
    SELECT COUNT(*) AS INS_CNT
    FROM {{ source('DDSTG', 'ACCT_BALN_BKDT_STG2') }}
),

del_cnt AS (
    SELECT COUNT(*) AS DEL_CNT
    FROM {{ source('DDSTG', 'ACCT_BALN_BKDT_STG1') }}
),

max_pros_key AS (
    SELECT MAX(PROS_KEY_I) AS MAX_PROS_KEY_I
    FROM {{ source('VTECH', 'UTIL_PROS_ISAC') }}
    WHERE CONV_M = 'CAD_X01_ACCT_BALN_BKDT'
)

UPDATE {{ source('CAD_PROD_DATA', 'UTIL_PROS_ISAC') }}
SET 
    COMT_F = 'Y',
    SUCC_F = 'Y',
    COMT_S = CURRENT_TIMESTAMP(0),
    SYST_INS_Q = (SELECT INS_CNT FROM ins_cnt),
    SYST_DEL_Q = (SELECT DEL_CNT FROM del_cnt)
WHERE 
    CONV_M = 'CAD_X01_ACCT_BALN_BKDT'
    AND PROS_KEY_I = (SELECT MAX_PROS_KEY_I FROM max_pros_key);
```