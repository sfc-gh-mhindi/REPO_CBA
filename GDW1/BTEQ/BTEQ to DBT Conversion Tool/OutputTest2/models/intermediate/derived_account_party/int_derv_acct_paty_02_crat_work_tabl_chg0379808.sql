-- =====================================================================
-- DBT Model: DERV_ACCT_PATY_02_CRAT_WORK_TABL_CHG0379808
-- Converted from BTEQ: DERV_ACCT_PATY_02_CRAT_WORK_TABL_CHG0379808.sql
-- Category: derived_account_party
-- Original Size: 32.7KB, 800 lines
-- Complexity Score: 753
-- Generated: 2025-08-21 10:48:28
-- =====================================================================

{{ intermediate_model_config() }}


.IF ERRORLEVEL <> 0 THEN 

------------------------------------------------------------------------------
-- Object Name             :  DERV_ACCT_PATY_02_CRAT_WORK_TABL.sql
-- Object Type             :  BTEQ

--                           
-- Description             :  Create work/staging tables that will be used in this stream  
--                          
------------------------------------------------------------------------------
-- Modification History
-- Date               Author           Version     Version Description
-- 04/06/2013         Helen Zak        1.0         Initial Version
-- 07/08/2013         Helen Zak        1.1         C0714578 - post-implementation fixes 
--                                                 Add missing grant index on DERV_ACCT_PATY_RM  
--                                                 Create 3 tables for persisting GRD views and populate them
-- 18/08/2013         Helen Zak        1.2         C0726912 - post-implementation fix
--                                                 more working tables and remove redundant tables
-- 28/08/2013         Helen Zak        1.3         C0733426
--                                                 more working tables and more grants 
-- 02/09/2013         Helen Zak        1.4         C0737261
--                                                 more working tables and more grants 
--                                                 and remove redundant tables and grants 
-- 11/09/2013        Helen Zak        1.5          C0746488 
--                                                 New work table to syncronise ROW_SECU_ACCS_C
--                                                 with ACCT_PATY   
-- 25/08/2016        A&IPlatformRRTSquad@cba.com.au
--				      1.6          C2039845
--                                                 DERV_ACCT_PATY PRTF_PATY_F Update for FUND HOLDER     
------------------------------------------------------------------------------

-- Drop all work tables just in case. 


DROP TABLE {{ bteq_var("DDSTG") }}.ACCT_PATY_REL_THA;

.QUIT ERRORCODE

.LABEL NEXT1

DROP TABLE {{ bteq_var("DDSTG") }}.ACCT_PATY_THA_NEW_RNGE;

.QUIT ERRORCODE

.LABEL NEXT2



DROP TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CURR;

.QUIT ERRORCODE

.LABEL NEXT3

DROP TABLE {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_STAG;
.QUIT ERRORCODE

.LABEL NEXT4

DROP TABLE {{ bteq_var("DDSTG") }}.DERV_PRTF_PATY_STAG;
.QUIT ERRORCODE

.LABEL NEXT5

DROP TABLE {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_STAG;
.QUIT ERRORCODE

.LABEL NEXT6


DROP  TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_RM;
.QUIT ERRORCODE

.LABEL NEXT7



DROP TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_ADD;
.QUIT ERRORCODE

.LABEL NEXT8

DROP TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CHG;
.QUIT ERRORCODE

.LABEL NEXT9

DROP TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_FLAG;
.QUIT ERRORCODE

.LABEL NEXT10


DROP TABLE {{ bteq_var("DDSTG") }}.ACCT_PATY_REL_WSS;
.QUIT ERRORCODE

.LABEL NEXT11


DROP TABLE {{ bteq_var("DDSTG") }}.ACCT_REL_WSS_DITPS;
.QUIT ERRORCODE

.LABEL NEXT12




DROP TABLE {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_PATY_HOLD;
.QUIT ERRORCODE

.LABEL NEXT13

DROP TABLE {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_UNID_PATY;
.QUIT ERRORCODE

.LABEL NEXT14

DROP TABLE {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_PATY_REL;
.QUIT ERRORCODE

.LABEL NEXT15

DROP TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_DEL;
.QUIT ERRORCODE

.LABEL NEXT16


DROP TABLE {{ bteq_var("DDSTG") }}.ACCT_PATY_DEDUP;

.QUIT ERRORCODE

.LABEL NEXT17

DROP TABLE {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_PSST;

.QUIT ERRORCODE

.LABEL NEXT18

DROP  TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_NON_RM;
.QUIT ERRORCODE

.LABEL NEXT19

DROP  TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_ROW_SECU_FIX;
.QUIT ERRORCODE

.LABEL NEXT20
	
---- 1. Create new Staging Table {{ bteq_var("DDSTG") }}.ACCT_PATY_THA_NEW_RNGE 

CREATE SET TABLE {{ bteq_var("DDSTG") }}.ACCT_PATY_THA_NEW_RNGE ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
      THA_ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Thaler Account Identifier' NOT NULL,
      TRAD_ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Trading Account Identifier' NOT NULL,
      EFFT_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Effective Date' NOT NULL,
      EXPY_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Expiry Date' NOT NULL,
      NEW_EXPY_D DATE FORMAT 'YYYY-MM-DD' TITLE 'New Expiry Date')
PRIMARY INDEX ( TRAD_ACCT_I );

--Collect Initial Statistics on the new staging table

COLLECT STATS ON {{ bteq_var("DDSTG") }}.ACCT_PATY_THA_NEW_RNGE INDEX(TRAD_ACCT_I);

----2. Create new Staging Table {{ bteq_var("DDSTG") }}.ACCT_PATY_REL_THA 

CREATE MULTISET TABLE {{ bteq_var("DDSTG") }}.ACCT_PATY_REL_THA ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
      THA_ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Thaler Account Identifier' NOT NULL,
      TRAD_ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Trading Account Identifier' NOT NULL,
      EFFT_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Effective Date' NOT NULL,
      EXPY_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Expiry Date' NOT NULL)
PRIMARY INDEX ( TRAD_ACCT_I );


--Collect Initial Statistics on the new staging table

COLLECT STATS ON {{ bteq_var("DDSTG") }}.ACCT_PATY_REL_THA INDEX(TRAD_ACCT_I);





----3. Create new Table {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CURR

CREATE SET TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CURR ,NO FALLBACK ,
	     NO BEFORE JOURNAL,
	     NO AFTER JOURNAL,
	     CHECKSUM = DEFAULT
	     (
	      ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Identifier' NOT NULL,
	      PATY_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Identifier' NOT NULL,
	      ASSC_ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Associated Account Identifier' NOT NULL,
	      PATY_ACCT_REL_C CHAR(6) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Account Relationship Code' NOT NULL 
	      COMPRESS ('ADD   ','BCA010','BCA030','COO   ','PRI   ','SOL   ','ZBCA10','ZINTE0'),  /* C2039849 _IM1317265_ Revenue_Attribution_to_Fund_Holder Change  */
	      PRFR_PATY_F CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Preferred Party Flag' COMPRESS ('N','Y'),
	      SRCE_SYST_C CHAR(3) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Source System Code' COMPRESS ('CIF','SAP'),
	      EFFT_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Effective Date' NOT NULL,
	      EXPY_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Expiry Date' NOT NULL,
	      ROW_SECU_ACCS_C INTEGER TITLE 'ROW SECURITY ACCESS CODE' NOT NULL DEFAULT 0  COMPRESS 0 
	      )
	PRIMARY INDEX ( ACCT_I )
	INDEX ( ASSC_ACCT_I )
	INDEX ( PATY_I );
		
	COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CURR INDEX ( ACCT_I );
		
	COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CURR INDEX ( ASSC_ACCT_I );
		
	COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CURR INDEX ( PATY_I );
     
   COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CURR COLUMN EFFT_D;
      
    COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CURR COLUMN EXPY_D;
   
 COLLECT  STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CURR  COLUMN PATY_ACCT_REL_C;
    
----4. Create new Staging Table {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_STAG

CREATE MULTISET TABLE {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_STAG ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
      ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Identifier',
      PRTF_CODE_X VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Derived Portfolio Code')
PRIMARY INDEX ( ACCT_I );

COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_STAG INDEX ( ACCT_I );


-- Statistics collection not needed in Snowflake

----5. Create new Staging Table {{ bteq_var("DDSTG") }}.DERV_PRTF_PATY_STAG

CREATE MULTISET TABLE {{ bteq_var("DDSTG") }}.DERV_PRTF_PATY_STAG ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
      PATY_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Identifier',
      PRTF_CODE_X VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Derived Portfolio Code')
PRIMARY INDEX ( PATY_I );

COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_PRTF_PATY_STAG INDEX ( PATY_I );

-- Statistics collection not needed in Snowflake

----6. Create new Staging Table {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_STAG

CREATE SET TABLE {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_STAG,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Identifier', 
      PATY_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Identifier',
      ACCT_PRTF_C VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Portfolio Code',
      PATY_PRTF_C VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Portfolio Code',
	  PATY_ACCT_REL_C CHAR(6)  TITLE 'Paty Account Relationship', /* C2039849 _IM1317265_ Revenue_Attribution_to_Fund_Holder  Change  */			   
      RANK_I INTEGER  TITLE 'RANK'		   /* C2039849 _IM1317265_ Revenue_Attribution_to_Fund_Holder  Change  */      

       )
PRIMARY INDEX ( ACCT_I );

COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_STAG INDEX ( ACCT_I );

----7. Create new Table {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_RM

CREATE MULTISET TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_RM ,NO FALLBACK ,
	     NO BEFORE JOURNAL,
	     NO AFTER JOURNAL,
	     CHECKSUM = DEFAULT
	     (
	      ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Identifier' NOT NULL,
	      PATY_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Identifier' NOT NULL,
	      ASSC_ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Associated Account Identifier' NOT NULL,
	      PATY_ACCT_REL_C CHAR(6) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Account Relationship Code' NOT NULL 
	      COMPRESS ('ADD   ','BCA010','BCA030','COO   ','PRI   ','SOL   ','ZBCA10','ZINTE0'),  /* C2039849 _IM1317265_ Revenue_Attribution_to_Fund_Holder Change  */
	      PRFR_PATY_F CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Preferred Party Flag' COMPRESS ('N','Y'),
	      SRCE_SYST_C CHAR(3) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Source System Code' COMPRESS ('CIF','SAP'),
	      EFFT_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Effective Date' NOT NULL,
	      EXPY_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Expiry Date' NOT NULL,
	      ROW_SECU_ACCS_C INTEGER TITLE 'ROW SECURITY ACCESS CODE' NOT NULL DEFAULT 0  COMPRESS 0
	      )
	PRIMARY INDEX ( ACCT_I );
		
	COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_RM INDEX ( ACCT_I );
		
	COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_RM COLUMN PATY_I;
		
	COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_RM COLUMN PATY_ACCT_REL_C;
		
----8. Create new Table {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_NON_RM

CREATE MULTISET TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_NON_RM ,NO FALLBACK ,
	     NO BEFORE JOURNAL,
	     NO AFTER JOURNAL,
	     CHECKSUM = DEFAULT
	     (
	      ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Identifier' NOT NULL,
	      PATY_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Identifier' NOT NULL,
	      ASSC_ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Associated Account Identifier' NOT NULL,
	      PATY_ACCT_REL_C CHAR(6) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Account Relationship Code' NOT NULL 
	      COMPRESS ('ADD   ','BCA010','BCA030','COO   ','PRI   ','SOL   ','ZBCA10','ZINTE0'),  /* C2039849 _IM1317265_ Revenue_Attribution_to_Fund_Holder Change  */
	      PRFR_PATY_F CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Preferred Party Flag' COMPRESS ('N','Y'),
	      SRCE_SYST_C CHAR(3) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Source System Code' COMPRESS ('CIF','SAP'),
	      EFFT_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Effective Date' NOT NULL,
	      EXPY_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Expiry Date' NOT NULL,
	      ROW_SECU_ACCS_C INTEGER TITLE 'ROW SECURITY ACCESS CODE' NOT NULL DEFAULT 0  COMPRESS 0,
		  RANK_I INTEGER       /* C2039849 _IM1317265_ Revenue_Attribution_to_Fund_Holder  Change  */

	      )
	PRIMARY INDEX ( ACCT_I );
		
	COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_NON_RM INDEX ( ACCT_I );
	
     COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_NON_RM COLUMN PATY_I;
		
	COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_NON_RM COLUMN PATY_ACCT_REL_C;
	
----9. Create new Table {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_FLAG

CREATE SET TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_FLAG ,NO FALLBACK ,
	     NO BEFORE JOURNAL,
	     NO AFTER JOURNAL,
	     CHECKSUM = DEFAULT
	     (
	      ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Identifier' NOT NULL,
	      PATY_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Identifier' NOT NULL,
	      ASSC_ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Associated Account Identifier' NOT NULL,
	      PATY_ACCT_REL_C CHAR(6) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Account Relationship Code' NOT NULL 
	      COMPRESS ('ADD   ','BCA010','BCA030','COO   ','PRI   ','SOL   ','ZBCA10','ZINTE0'),  /* C2039849 _IM1317265_ Revenue_Attribution_to_Fund_Holder Change  */
	      PRFR_PATY_F CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Preferred Party Flag' COMPRESS ('N','Y'),
	      SRCE_SYST_C CHAR(3) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Source System Code' COMPRESS ('CIF','SAP'),
	      EFFT_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Effective Date' NOT NULL,
	      EXPY_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Expiry Date' NOT NULL,
	      ROW_SECU_ACCS_C INTEGER TITLE 'ROW SECURITY ACCESS CODE' NOT NULL DEFAULT 0  COMPRESS 0
	      )
	PRIMARY INDEX ( ACCT_I ); 
	

COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_FLAG INDEX ( ACCT_I );
	
----10. Create new Table {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_ADD


CREATE MULTISET TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_ADD ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
      ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Identifier' NOT NULL,
      PATY_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Identifier' NOT NULL,
      ASSC_ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Associated Account Identifier' NOT NULL,
      PATY_ACCT_REL_C CHAR(6) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Account Relationship Code' NOT NULL 
      COMPRESS ('ADD   ','BCA010','BCA030','COO   ','PRI   ','SOL   ','ZBCA10','ZINTE0'),  /* C2039849 _IM1317265_ Revenue_Attribution_to_Fund_Holder Change  */
      PRFR_PATY_F CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Preferred Party Flag' COMPRESS ('N','Y'),
      SRCE_SYST_C CHAR(3) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Source System Code' COMPRESS ('CIF','SAP'),
      EFFT_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Effective Date' NOT NULL,
      EXPY_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Expiry Date' NOT NULL,
      ROW_SECU_ACCS_C INTEGER TITLE 'ROW SECURITY ACCESS CODE' NOT NULL DEFAULT 0  COMPRESS 0)
PRIMARY INDEX ( ACCT_I )
INDEX ( PATY_I );


COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_ADD  INDEX ( ACCT_I );

COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_ADD  INDEX ( PATY_I );


----11. Create new Table {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CHG


CREATE MULTISET TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CHG ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
      ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Identifier' NOT NULL,
      PATY_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Identifier' NOT NULL,
      ASSC_ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Associated Account Identifier' NOT NULL,
      PATY_ACCT_REL_C CHAR(6) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Account Relationship Code' NOT NULL 
      COMPRESS ('ADD   ','BCA010','BCA030','COO   ','PRI   ','SOL   ','ZBCA10','ZINTE0'),  /* C2039849 _IM1317265_ Revenue_Attribution_to_Fund_Holder Change  */
      PRFR_PATY_F CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Preferred Party Flag' COMPRESS ('N','Y'),
      SRCE_SYST_C CHAR(3) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Source System Code' COMPRESS ('CIF','SAP'),
      EFFT_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Effective Date' NOT NULL,
      EXPY_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Expiry Date' NOT NULL,
      
      ROW_SECU_ACCS_C INTEGER TITLE 'ROW SECURITY ACCESS CODE' NOT NULL DEFAULT 0  COMPRESS 0)
PRIMARY INDEX ( ACCT_I )
INDEX ( PATY_I );


COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CHG  INDEX ( ACCT_I );

COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CHG  INDEX ( PATY_I );

----12. Create new Table {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_DEL

CREATE MULTISET TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_DEL ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
      ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Identifier' NOT NULL,
      PATY_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Identifier' NOT NULL,
      ASSC_ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Associated Account Identifier' NOT NULL,
      PATY_ACCT_REL_C CHAR(6) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Account Relationship Code' NOT NULL 
      COMPRESS ('DEL   ','BCA010','BCA030','COO   ','PRI   ','SOL   ','ZBCA10','ZINTE0'),  /* C2039849 _IM1317265_ Revenue_Attribution_to_Fund_Holder Change  */
      PRFR_PATY_F CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Preferred Party Flag' COMPRESS ('N','Y'),
      SRCE_SYST_C CHAR(3) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Source System Code' COMPRESS ('CIF','SAP'),
      EFFT_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Effective Date' NOT NULL,
      EXPY_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Expiry Date' NOT NULL,
      ROW_SECU_ACCS_C INTEGER TITLE 'ROW SECURITY ACCESS CODE' NOT NULL DEFAULT 0  COMPRESS 0)
PRIMARY INDEX ( ACCT_I )
INDEX ( PATY_I );


COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_DEL  INDEX ( ACCT_I );

COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_DEL  INDEX ( PATY_I );

----13. Create new Table {{ bteq_var("DDSTG") }}.ACCT_PATY_REL_WSS

CREATE MULTISET TABLE {{ bteq_var("DDSTG") }}.ACCT_PATY_REL_WSS ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
      ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Identifier' NOT NULL,
      PATY_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Identifier' NOT NULL,
      ASSC_ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Associated Account Identifier' NOT NULL,
      PATY_ACCT_REL_C CHAR(6) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Account Relationship Code' NOT NULL 
      COMPRESS ('ADD   ','BCA010','BCA030','COO   ','PRI   ','SOL   ','ZBCA10','ZINTE0'),  /* C2039849 _IM1317265_ Revenue_Attribution_to_Fund_Holder Change  */
      PRFR_PATY_F CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Preferred Party Flag' COMPRESS ('N','Y'),
      SRCE_SYST_C CHAR(3) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Source System Code' COMPRESS ('CIF','SAP'),
      EFFT_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Effective Date' NOT NULL,
      EXPY_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Expiry Date' NOT NULL,
      ROW_SECU_ACCS_C INTEGER TITLE 'ROW SECURITY ACCESS CODE' NOT NULL DEFAULT 0  COMPRESS 0 )
PRIMARY INDEX ( ACCT_I );


COMMENT ON TABLE {{ bteq_var("DDSTG") }}.ACCT_PATY_REL_WSS
'DERV_ACCT_PATY  work table for WSS accounts';

COLLECT STATS ON {{ bteq_var("DDSTG") }}.ACCT_PATY_REL_WSS INDEX(ACCT_I);

----14. Create new Table {{ bteq_var("DDSTG") }}.ACCT_PATY_WSS_DITPS

CREATE SET TABLE {{ bteq_var("DDSTG") }}.ACCT_REL_WSS_DITPS ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
      ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'ACCOUNT IDENTIFIER' NOT NULL)
PRIMARY INDEX ( ACCT_I );

COLLECT STATS {{ bteq_var("DDSTG") }}.ACCT_REL_WSS_DITPS INDEX(ACCT_I);


----15. Create new Table {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_PATY_HOLD

CREATE SET TABLE {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_PATY_HOLD ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
      MAP_TYPE_C VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'MAPPING TYPE CODE' NOT NULL,
      PATY_ACCT_REL_C  VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Party Relationship Code',
      PATY_ACCT_REL_X  VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Party Relationship Code Description',
      EFFT_D DATE FORMAT 'YYYY-MM-DD' TITLE 'EFFECTIVE ' NOT NULL,
      EXPY_D DATE FORMAT '::DATEYYYY-MM-DD' TITLE 'EXPIRY ' NOT NULL DEFAULT DATE '::DATE9999-12-31')
 PRIMARY INDEX ( PATY_ACCT_REL_C );
  
 COLLECT STATS {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_PATY_HOLD INDEX ( PATY_ACCT_REL_C );
 
 INSERT INTO {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_PATY_HOLD
 SELECT MAP_TYPE_C
               ,PATY_ACCT_REL_C
               ,PATY_ACCT_REL_X
               ,EFFT_D
               ,EXPY_D
      FROM  {{ bteq_var("VTECH") }}.GRD_GNRC_MAP_DERV_PATY_HOLD; 
       

  COLLECT STATS {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_PATY_HOLD;  
   
 ----16. Create new Table {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_UNID_PATY
  
  CREATE SET TABLE {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_UNID_PATY ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
      MAP_TYPE_C VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'MAPPING TYPE CODE' NOT NULL,
      SRCE_SYST_C  VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Source System Code',
      UNID_PATY_SRCE_SYST_C  VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Unidentified Party Source System Code',
      UNID_PATY_ACCT_REL_C  VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Unidentified Party Account Relationship Code',
      EFFT_D DATE FORMAT 'YYYY-MM-DD' TITLE 'EFFECTIVE ' NOT NULL,
      EXPY_D DATE FORMAT '::DATEYYYY-MM-DD' TITLE 'EXPIRY ' NOT NULL DEFAULT DATE '::DATE9999-12-31')
 PRIMARY INDEX ( SRCE_SYST_C );
    
 COLLECT STATS {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_UNID_PATY INDEX ( SRCE_SYST_C );
    
 INSERT INTO {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_UNID_PATY
 SELECT MAP_TYPE_C
               ,SRCE_SYST_C
               ,UNID_PATY_SRCE_SYST_C
               ,UNID_PATY_ACCT_REL_C
               ,EFFT_D
               ,EXPY_D
      FROM   {{ bteq_var("VTECH") }}.GRD_GNRC_MAP_DERV_UNID_PATY;   
          
 COLLECT STATS {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_UNID_PATY;    
    
 ----17. Create new Table {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_PATY_REL
  
  CREATE SET TABLE {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_PATY_REL ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
      MAP_TYPE_C VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'MAPPING TYPE CODE' NOT NULL,
      SRCE_SYST_C  VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Source System Code',
      REL_C  VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Relationship Code',
      ACCT_I_C  VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Code',
      EFFT_D DATE FORMAT 'YYYY-MM-DD' TITLE 'EFFECTIVE ' NOT NULL,
      EXPY_D DATE FORMAT '::DATEYYYY-MM-DD' TITLE 'EXPIRY ' NOT NULL DEFAULT DATE '::DATE9999-12-31')
 PRIMARY INDEX ( REL_C );
    
 COLLECT STATS {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_PATY_REL INDEX ( REL_C );
    
 INSERT INTO {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_PATY_REL
 SELECT MAP_TYPE_C
               ,SRCE_SYST_C
               ,REL_C
               ,ACCT_I_C
               ,EFFT_D
               ,EXPY_D
      FROM   {{ bteq_var("VTECH") }}.GRD_GNRC_MAP_DERV_PATY_REL;   
              
 COLLECT STATS {{ bteq_var("DDSTG") }}.GRD_GNRC_MAP_DERV_PATY_REL;   
   

---- 18.Create new Table {{ bteq_var("DDSTG") }}.ACCT_PATY_DEDUP

CREATE SET TABLE {{ bteq_var("DDSTG") }}.ACCT_PATY_DEDUP ,NO FALLBACK ,
	     NO BEFORE JOURNAL,
	     NO AFTER JOURNAL,
	     CHECKSUM = DEFAULT
	     (
	      ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Identifier' NOT NULL,
	      PATY_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Identifier' NOT NULL,
	      ASSC_ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Associated Account Identifier' NOT NULL,
	      PATY_ACCT_REL_C CHAR(6) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Account Relationship Code' NOT NULL 
	      COMPRESS ('ADD   ','BCA010','BCA030','COO   ','PRI   ','SOL   ','ZBCA10','ZINTE0'),  /* C2039849 _IM1317265_ Revenue_Attribution_to_Fund_Holder Change  */
	      PRFR_PATY_F CHAR(1) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Preferred Party Flag' COMPRESS ('N','Y'),
	      SRCE_SYST_C CHAR(3) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Source System Code' COMPRESS ('CIF','SAP'),
	      EFFT_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Effective Date' NOT NULL,
	      EXPY_D DATE FORMAT 'YYYY-MM-DD' TITLE 'Expiry Date' NOT NULL,
	      ROW_SECU_ACCS_C INTEGER TITLE 'ROW SECURITY ACCESS CODE' NOT NULL DEFAULT 0  COMPRESS 0 
	      )
	PRIMARY INDEX ( ACCT_I )
	;
		
	COLLECT STATS {{ bteq_var("DDSTG") }}.ACCT_PATY_DEDUP INDEX ( ACCT_I );
		
----19. Create new Table {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_PSST

CREATE SET TABLE {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_PSST ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
      ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Identifier',
      PATY_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Party Identifier',
      ACCT_PRTF_C VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Portfolio Code',
	  RANK_I INTEGER,             /* C2039849 _IM1317265_ Revenue_Attribution_to_Fund_Holder  Change  */
	  PATY_ACCT_REL_C CHAR(6)   /* C2039849 _IM1317265_ Revenue_Attribution_to_Fund_Holder  Change  */	
      )
PRIMARY INDEX ( ACCT_I )
INDEX(PATY_I);

COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_PSST INDEX ( ACCT_I );	

COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_PSST INDEX ( PATY_I );	

COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_PSST COLUMN ACCT_PRTF_C;	
   
----20. Create new Table {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_ROW_SECU_FIX

CREATE MULTISET TABLE {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_ROW_SECU_FIX ,NO FALLBACK ,
     NO BEFORE JOURNAL,
     NO AFTER JOURNAL,
     CHECKSUM = DEFAULT
     (
      ACCT_I VARCHAR(255) CHARACTER SET LATIN NOT CASESPECIFIC TITLE 'Account Identifier' NOT NULL,
      DERV_ACCT_PATY_ROW_SECU_ACCS_C INTEGER TITLE 'DERV ACCT_PATY ROW SECURITY ACCESS CODE' NOT NULL DEFAULT 0  COMPRESS 0,
      ACCT_PATY_ROW_SECU_ACCS_C INTEGER TITLE 'ACCT_PATY ROW SECURITY ACCESS CODE' NOT NULL DEFAULT 0  COMPRESS 0 )
PRIMARY INDEX ( ACCT_I );

COLLECT STATS {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_ROW_SECU_FIX INDEX ( ACCT_I );

   
-- Grant accesses to the tables that have just been created to the users that will access them
-- Grant INDEX access to individual tables

      GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_STAG TO {{ bteq_var("UCB") }}2220;
            
      GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_PRTF_PATY_STAG TO {{ bteq_var("UCB") }}2220;
            GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_STAG TO {{ bteq_var("UCB") }}2220;
      
      GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_STAG TO {{ bteq_var("UCB") }}2221;
            
    
     GRANT INDEX ON {{ bteq_var("DDSTG") }}.ACCT_PATY_REL_WSS TO {{ bteq_var("UCB") }}2221;
          GRANT INDEX ON {{ bteq_var("DDSTG") }}.ACCT_REL_WSS_DITPS TO {{ bteq_var("UCB") }}2221;
          GRANT INDEX ON {{ bteq_var("DDSTG") }}.ACCT_PATY_REL_WSS TO {{ bteq_var("UCB") }}2221;
         
     GRANT INDEX ON {{ bteq_var("DDSTG") }}.ACCT_PATY_REL_THA TO {{ bteq_var("UCB") }}2221;
         GRANT INDEX ON {{ bteq_var("DDSTG") }}.ACCT_PATY_THA_NEW_RNGE TO {{ bteq_var("UCB") }}2221;
        GRANT INDEX ON {{ bteq_var("DDSTG") }}.ACCT_PATY_THA_NEW_RNGE TO {{ bteq_var("UCB") }}2221;
        GRANT INDEX ON {{ bteq_var("DDSTG") }}.ACCT_PATY_REL_THA TO {{ bteq_var("UCB") }}2221;
        GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CURR TO {{ bteq_var("UCB") }}2221;
         GRANT INDEX ON {{ bteq_var("DDSTG") }}.ACCT_PATY_DEDUP TO {{ bteq_var("UCB") }}2221;
       
      GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_RM TO {{ bteq_var("UCB") }}2222;
           
      GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_STAG TO {{ bteq_var("UCB") }}2222;
         
      GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_PRTF_ACCT_PATY_PSST TO {{ bteq_var("UCB") }}2222;
            
   
     
    
     GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_NON_RM TO {{ bteq_var("UCB") }}2223;
            
      GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_FLAG TO {{ bteq_var("UCB") }}2223;
      

      GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_ADD TO {{ bteq_var("UCB") }}2224;
            GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CHG TO {{ bteq_var("UCB") }}2224;
            GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_DEL TO {{ bteq_var("UCB") }}2224;
            
      GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_ADD TO {{ bteq_var("UCB") }}2225;
            GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_CHG TO {{ bteq_var("UCB") }}2225;
             GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_DEL TO {{ bteq_var("UCB") }}2225;
            
       GRANT INDEX ON {{ bteq_var("DDSTG") }}.DERV_ACCT_PATY_ROW_SECU_FIX TO {{ bteq_var("UCB") }}2225;
            
.QUIT 0

-- $LastChangedBy: zakhe $
-- $LastChangedDate: 2013-09-11 15:36:32 +1000 (Wed, 11 Sep 2013) $
-- $LastChangedRevision: 12624 $

.LABEL EXITERR
.QUIT 4
