{{
  config(
    post_hook=[
      'INSERT OVERWRITE INTO '~ cvar("intermediate_db") ~ '.'~ cvar("files_schema") ~ '.'~ cvar("pinprocess") ~ '__' ~ cvar("pcfilename") ~ '_' ~ cvar("pctable_name") ~ '_' ~ cvar("prun_strm_pros_d") ~'_I__TXT SELECT * FROM {{ this }}'
    ]
  )
}}

SELECT 
	TRIM(BCF_CORP) AS CORP_IDNN,
	CONCAT('CCSCC', TRIM(BCF_ACCOUNT_NO1)) AS ACCT_I,
	TRIM(BCF_PLAN_ID) AS PLAN_IDNN,
	BCF_PLAN_SEQ AS PLAN_SQNO,
	IFF(TRIM(IFNULL(BCF_ACCOUNT_NO1, '')) = '', NULL, TRIM(BCF_ACCOUNT_NO1)) AS SRCE_SYST_ACCT_NUMB,
	IFF(TRIM(IFNULL(BCF_STORE_ID, '')) = '', NULL, TRIM(BCF_STORE_ID)) AS STOR_IDNN,
	IFF(TRIM(IFNULL(BCF_ORIGINAL_STATE, '')) = '', NULL, TRIM(BCF_ORIGINAL_STATE)) AS ORIG_STAT,
	IFF(TRIM(IFNULL(BCF_PLAN_TYPE, '')) = '', NULL, TRIM(BCF_PLAN_TYPE)) AS PLAN_TYPE,
	IFF(TRIM(IFNULL(BCF_PLAN_CATEGORY, '')) = '', NULL, TRIM(BCF_PLAN_CATEGORY)) AS PLAN_CATG,
	IFF(TRIM(IFNULL(BCF_POST_PURCHASE_STATUS, '')) = '', NULL, TRIM(BCF_POST_PURCHASE_STATUS)) AS POST_PUR_STUS,
	IFF(TRIM(IFNULL(BCF_TERMS_STATUS, '')) = '', NULL, TRIM(BCF_TERMS_STATUS)) AS TERM_STUS,
	IFF(TRIM(IFNULL(BCF_INTEREST_DEFER_STATUS, '')) = '', NULL, TRIM(BCF_INTEREST_DEFER_STATUS)) AS INT_DEFR_STUS,
	IFF(TRIM(IFNULL(BCF_PAYMENT_DEFER_STATUS, '')) = '', NULL, TRIM(BCF_PAYMENT_DEFER_STATUS)) AS PAYT_DEFR_STUS,	
	BCF_TIMES_BILLED AS TIME_BILL,
	BCF_SPECIAL_TERMS_CYCLES AS SPEC_TERM_CYCL,
	BCF_INTEREST_DEFER_CYCLES AS INT_DEFR_CYCL,
	BCF_PAYMENT_DEFER_CYCLES AS PAYT_DEFR_CYCL,
	IFF(svIsNullBcfDtSpecTermsEnd = 'N', NULL, IFF(svIsValidBcfDtSpecTermsEnd = 'N', '1111-11-11', svTransformBcfDtSpecTermsEnd)) AS DATE_SPEC_TERM_END,
	IFF(svIsNullBcfDtInterestDefer = 'N', NULL, IFF(svIsValidBcfDtInterestDefer = 'N', '1111-11-11', svTransformBcfDtInterestDefer)) AS DATE_INT_DEFR_END,
	IFF(svIsNullBcfDtPaymentDefer = 'N', NULL, IFF(svIsValidBcfDtPaymentDefer = 'N', '1111-11-11', svTransformBcfDtPaymentDefer)) AS DATE_PAYT_DEFR_END,
	IFF(svIsNullBcfDtFirstTrans = 'N', NULL, IFF(svIsValidBcfDtFirstTrans = 'N', '1111-11-11', svTransformBcfDtFirstTrans)) AS DATE_FRST_TRAN,
	IFF(svIsNullBcfDtPaidOff = 'N', NULL, IFF(svIsValidBcfDtPaidOff = 'N', '1111-11-11', svTransformBcfDtPaidOff)) AS DATE_PAID_OFF,
	IFF(svIsNullBcfDtLastPayt = 'N', NULL, IFF(svIsValidBcfDtLastPayt = 'N', '1111-11-11', svTransformBcfDtLastPayt)) AS DATE_LAST_PAYT,
	IFF(svIsNullBcfDtLastMntn = 'N', NULL, IFF(svIsValidBcfDtLastMntn = 'N', '1111-11-11', svTransformBcfDtLastMntn)) AS DATE_LAST_MNTN,
	BCF_LTD_HIGH_BALANCE AS LFTD_HIGH_BALN,
	BCF_PYMT_TBL_HIGH_BALANCE AS PAYT_TABL_HIGH_BALN,
	BCF_LTD_INTEREST_CHGD AS LFTD_ICHG,
	BCF_LTD_INTEREST_WAIVED AS LFTD_INT_WAVR,
	BCF_FIXED_PAY_AMT AS FIX_PAYT_AMT,
	BCF_FIXED_PAY_CYCLES AS FIX_PACY,
	BCF_LAST_INT_RATE AS LAST_IRTE,
	IFF(TRIM(IFNULL(BCF_LAST_RATE_CODE, '')) = '', NULL, TRIM(BCF_LAST_RATE_CODE)) AS LAST_RATE_CODE,
	BCF_LAST_RATE_CODE_SEQ AS LAST_RATE_CODE_SEQN,
	IFF(TRIM(IFNULL(BCF_LAST_MIN_PAY_CODE, '')) = '', NULL, TRIM(BCF_LAST_MIN_PAY_CODE)) AS LAST_MIN_PAYT_CODE,
	BCF_LAST_MIN_PAY_CODE_SEQ AS LAST_MIN_PAYT_CODE_SEQN,
	BCF_MIN_PAY_AMT AS LAST_MIN_PAYT_AMT,
	BCF_MIN_PAY_DUE AS CURR_MIN_PAYT_DUE,
	BCF_MIN_PAY_PAST_DUE AS MIN_PAYT_PAST_DUE,
	BCF_AMT_LAST_PYMT_APPLIED AS LAST_APPY_PAYT_AMT,
	BCF_PAYMENTS_BEFORE_GRACE AS PAYT_BFOR_GRCE,
	BCF_ORIGINAL_BALANCE AS ORIG_BALN,
	BCF_RATE_SAVER_RATE AS INT_SAVE_RATE,
	IFF(svIsNullBcfPlanDueDt = 'N', NULL, IFF(svIsValidBcfPlanDueDt = 'N', '1111-11-11', svTransformBcfPlanDueDt)) AS PLAN_DUE_DATE,
	IFF(svIsNullBcfDtEndInterestFree = 'N', NULL, IFF(svIsValidBcfDtEndInterestFree = 'N', '1111-11-11', svTransformBcfDtEndInterestFree)) AS INT_FEE_END_DATE,
	BCF_INTEREST_FREE_PRIN_AMT AS INT_FREE_BALN,
	BCF_OPENING_BALANCE AS OPEN_BALN_CURR_CYCL,
	BCF_CURRENT AS CTD_SALE_TRAN,
	BCF_DEBITS AS CTD_DR_TRAN,
	BCF_CREDITS AS CTD_CR_TRAN,
	BCF_PAYMENTS AS CTD_PAYT_TRAN,
	BCF_INT_OPEN_NON_ACCR AS INT_UNPD_OPEN_NOT_ACRL_BALN,
	BCF_INT_CTD_NON_ACCR AS INT_UNPD_CTD_NOT_ACRL_BALN,
	BCF_INT_CURR_CYC_BAL AS INT_UNPD_CURR_CYCL_BALN,
	BCF_INT_1CYC_AGO_BAL AS INT_UNPD_1_CYCL_AGO_BALN,
	BCF_INT_2CYC_AGO_BAL AS INT_UNPD_2_CYCL_AGO_BALN,
	BCF_FEES_OPEN_NON_ACCR AS FEE_UNPD_OPEN_NOT_ACRL_BALN,
	BCF_FEES_CTD_NON_ACCR AS FEE_UNPD_CTD_NOT_ACRL_BALN,
	BCF_FEES_CURR_CYC_BAL AS FEE_UNPD_CURR_CYCL_BALN,
	BCF_FEES_1CYC_AGO_BAL AS FEE_UNPD_1_CYCL_AGO_BALN,
	BCF_FEES_2CYC_AGO_BAL AS FEE_UNPD_2_CYCL_AGO_BALN,
	BCF_AMF_OPEN_NON_ACCR AS AMF_UNPD_OPEN_NOT_ACRL_BALN,
	BCF_AMF_CTD_NON_ACCR AS AMF_UNPD_CTD_NOT_ACRL_BALN,
	BCF_AMF_CURR_CYC_BAL AS AMF_UNPD_CURR_CYCL_BALN,
	BCF_AMF_1CYC_AGO_BAL AS AMF_UNPD_1_CYCL_AGO_BALN,
	BCF_AMF_2CYC_AGO_BAL AS AMF_UNPD_2_CYCL_AGO_BALN,
	BCF_INS_OPEN_NON_ACCR AS INSR_UNPD_OPEN_NOT_ACRL_BALN,
	BCF_INS_CTD_NON_ACCR AS INSR_UNPD_CTD_NOT_ACRL_BALN,
	BCF_INS_CURR_CYC_BAL AS INSR_UNPD_CURR_CYCL_BALN,
	BCF_INS_1CYC_AGO_BAL AS INSR_UNPD_1_CYCL_AGO_BALN,
	BCF_INS_2CYC_AGO_BAL AS INSR_UNPD_2_CYCL_AGO_BALN,
	BCF_PRIN_OPEN_NON_ACCR AS PRIN_UNPD_OPEN_NOT_ACRL_BALN,
	BCF_PRIN_CTD_NON_ACCR AS PRIN_UNPD_CTD_NOT_ACRL_BALN,
	BCF_PRIN_CURR_CYC_BAL AS PRIN_UNPD_CURR_CYCL_BALN,
	BCF_PRIN_1CYC_AGO_BAL AS PRIN_UNPD_1_CYCL_AGO_BALN,
	BCF_PRIN_2CYC_AGO_BAL AS PRIN_UNPD_2_CYCL_AGO_BALN,
	BCF_AGGR_CURR_CYC_BAL AS AGGR_CURR_CYCL_BALN,
	BCF_AGGR_1CYC_AGO_BAL AS AGGR_1_CYCL_AGO_BALN,
	BCF_AGGR_2CYC_AGO_BAL AS AGGR_2_CYCL_AGO_BALN,
	BCF_AGGR_DELAYED_BAL AS AGGR_DLAY_BALN,
	BCF_DELAYED_DAYS AS DLAY_DAY_QNTY,
	BCF_CTD_TRANS_FEE AS CTD_CSAD_FEE_AMT,
	BCF_CTD_TRANS_FEE_AMT AS CTD_SYST_GENR_CSAD_FEE_AMT,
	BCF_DEFERRED_DAYS AS INT_DEFR_DAY_QNTY,
	BCF_DEFERRED_INTEREST AS INT_DEFR_AMT,
	BCF_AGGR_DEFERRED_BAL AS INT_DEFR_AGGR_CURR_BALN,
	IFF(TRIM(IFNULL(BCF_USER_CODE, '')) = '', NULL, TRIM(BCF_USER_CODE)) AS USER_CODE,
	IFF(TRIM(IFNULL(BCF_MIGRATE_TO_PLAN, '')) = '', NULL, TRIM(BCF_MIGRATE_TO_PLAN)) AS MIGR_TO_PLAN_IDNN,
	BCF_MIGRATE_TO_SEQ AS MIGR_TO_PLAN_SQNO,
	IFF(svIsNullBcfDtMigrate = 'N', NULL, IFF(svIsValidBcfDtMigrate = 'N', '1111-11-11', svTransformBcfDtMigrate)) AS DATE_MIGR,
	BCF_DISPUTE_AMT AS DSPT_AMT,
	BCF_EXT_DISPUTE_AMT AS EXCL_DSPT_AMT,
	BCF_ACCR_DISPUTE_AMT AS ACRL_DSPT_AMT,
	BCF_FL_INSTALLMENTS_BILLED AS FRNT_LOAD_ISMT_BILL,
	IFF(svIsNullBcfFlLastInstallmentsDt = 'N', NULL, IFF(svIsValidBcfFlLastInstallmentsDt = 'N', '1111-11-11', svTransformBcfFlLastInstallmentsDt)) AS FRNT_LOAD_LAST_ISMT_DATE,
	BCF_FL_ORIG_INTEREST_AMT AS FRNT_LOAD_ORIG_INT_AMT,
	BCF_FL_EARNED_INTEREST_AMT AS FRNT_LOAD_EARN_INT_AMT,
	BCF_FL_REBATE_INTEREST_AMT AS FRNT_LOAD_REBT_INT_AMT,
	BCF_FL_INTEREST_RATE AS FRNT_LOAD_IRTE,
	BCF_FL_ORIG_INSUR_AMT AS FRNT_LOAD_ORIG_INSR_AMT,
	BCF_FL_EARNED_INSUR_AMT AS FRNT_LOAD_EARN_INSR_AMT,
	BCF_FL_UPFRONT_INSUR_AMT AS FRNT_LOAD_UPFR_INSR_AMT,
	BCF_FL_REBATE_INSUR_AMT AS FRNT_LOAD_REBT_INSR_AMT,
	IFF(svIsNullBcfSchedPayoffDt = 'N', NULL, IFF(svIsValidBcfSchedPayoffDt = 'N', '1111-11-11', svTransformBcfSchedPayoffDt)) AS SCHE_PAYF_DATE,
	BCF_SCHED_PAYOFF_AMT AS SCHE_PAYF_AMT,
	BCF_SCHED_PAYOFF_FEE AS SCHE_PAYF_FEE,
	IFF(TRIM(IFNULL(BCF_SCHED_PAYOFF_REASON, '')) = '', NULL, TRIM(BCF_SCHED_PAYOFF_REASON)) AS SCHE_PAYF_REAS,
	IFF(svIsNullBcfActualPayoffDt = 'N', NULL, IFF(svIsValidBcfActualPayoffDt = 'N', '1111-11-11', svTransformBcfActualPayoffDt)) AS ACTL_PAYF_DATE,
	BCF_ACTUAL_PAYOFF_AMT AS ACTL_PAYF_AMT,
	BCF_FL_UPFRONT_INSUR_PAID AS FRNT_LOAD_INSR_PAID,
	BCF_FL_REBATE_INSUR_PAID AS FRNT_LOAD_REBT_INSR_PAID,
	BCF_GOVT_NON_ACCR_OPN_AMT AS GOVT_CHRG_NOT_ACRL_OPEN_AMT,
	BCF_GOVT_NON_ACCR_CTD_AMT AS GOVT_CHRG_NOT_ACRL_CTD_AMT,
	BCF_GOVT_BAL_CURR_CYC_AMT AS GOVT_CHRG_CURR_CYCL_AMT,
	BCF_GOVT_BAL_1CYC_AGO_AMT AS GOVT_CHRG_1_CYCL_AGO_AMT,
	BCF_GOVT_BAL_2CYC_AGO_AMT AS GOVT_CHRG_2_CYCL_AGO_AMT,
	BCF_CTD_FIN_CHG_REV AS CTD_FNCL_CHRG_REV,
	BCF_INSTALL_TERM AS ISMT_QNTY,
	BCF_PREV_INSTALL_TERM AS ISMT_PREV_QNTY,
	IFF(svIsNullBcfDtInstallTermChg = 'N', NULL, IFF(svIsValidBcfDtInstallTermChg = 'N', '1111-11-11', svTransformBcfDtInstallTermChg)) AS DATE_ISMT_TERM_CHNG,
	BCF_PREV_MIN_PAY_AMT AS PREV_MIN_PAYT_AMT,
	BCF_ORIG_LOAN_BAL AS ORIG_LOAN_BALN,
	BCF_LTD_ALL_CRDTS AS LFTD_ALL_CR,
	BCF_LTD_INTEREST_SAVED AS LFTD_INT_SAVE,
	BCF_PREV_CYC_INT_SAVED AS PREV_CYCL_INT_SAVE,
	IFF(svIsNullBcfDtInstallPaid = 'N', NULL, IFF(svIsValidBcfDtInstallPaid = 'N', '1111-11-11', svTransformBcfDtInstallPaid)) AS DATE_LOAN_PAID_OUT,
	IFF(svIsNullBcfProjectedPayoffDt = 'N', NULL, IFF(svIsValidBcfProjectedPayoffDt = 'N', '1111-11-11', svTransformBcfProjectedPayoffDt)) AS PRJC_PAY_OFF_DATE,
	BCF_DISPUTE_TIMES AS DSPT_QNTY,
	IFF(svIsNullBcfDisputeOldDt = 'N', NULL, IFF(svIsValidBcfDisputeOldDt = 'N', '1111-11-11', svTransformBcfDisputeOldDt)) AS DSPT_OLD_DATE,
	BCF_TERM AS TERM,
	svRowI AS ROW_I,
	TO_TIMESTAMP(TO_DATE('{{ cvar("prun_strm_pros_d") }}', 'YYYYMMDD')) AS EFFT_S,
	TO_DATE('{{ cvar("prun_strm_pros_d") }}', 'YYYYMMDD') AS EFFT_D,
	'00:00:00' AS EFFT_T,
	'{{ cvar("pods_pros_id") }}' AS PROS_KEY_EFFT_I,
	0 AS ROW_SECU_ACCS_C

FROM {{ ref("xfmtotable__xfmplanbalnsegmmstrfrombcfinsg")}}
WHERE svIsValidRecord = 'N'