# DERV_ACCT_PATY_01_SP_GET_PROS_KEY.sql - BTEQ Analysis

## File Overview
- **File Name**: DERV_ACCT_PATY_01_SP_GET_PROS_KEY.sql
- **Analysis Status**: ‚úÖ Success
- **Control Statements**: 16
- **SQL Blocks**: 1

## Control Flow Analysis

| Line | Type | Statement |
|------|------|-----------|
| 1 | RUN | `.RUN FILE=%%BTEQ_LOGON_SCRIPT%%` |
| 2 | IF_ERRORCODE | `.IF ERRORCODE <> 0    THEN .GOTO EXITERR` |
| 31 | OS_CMD | `.OS rm /cba_app/CBMGDW/%%ENV_C%%/schedule/%%STRM_C%%_PROS_KEY.txt` |
| 32 | OS_CMD | `.OS rm /cba_app/CBMGDW/%%ENV_C%%/schedule/%%STRM_C%%_BTCH_DATE.txt` |
| 36 | IMPORT | `.IMPORT VARTEXT FILE=/cba_app/CBMGDW/%%ENV_C%%/schedule/%%STRM_C%%_BTCH_KEY.txt` |
| 37 | EXPORT | `.EXPORT DATA FILE=/cba_app/CBMGDW/%%ENV_C%%/schedule/%%STRM_C%%_BTCH_DATE.txt` |
| 49 | EXPORT | `.EXPORT RESET` |
| 51 | IF_ERRORCODE | ` .IF ERRORCODE <> 0    THEN .GOTO EXITERR` |
| 56 | IMPORT | `.IMPORT VARTEXT FILE=/cba_app/CBMGDW/%%ENV_C%%/schedule/%%STRM_C%%_BTCH_DATE.txt` |
| 57 | EXPORT | `.EXPORT DATA FILE=/cba_app/CBMGDW/%%ENV_C%%/schedule/%%STRM_C%%_PROS_KEY.txt` |
| 65 | CALL_SP | `CALL %%STARMACRDB%%.SP_GET_PROS_KEY(        
  '%%GDW_USER%%',           -- From...` |
| 77 | EXPORT | `.EXPORT RESET` |
| 79 | IF_ERRORCODE | `.IF ERRORCODE <> 0    THEN .GOTO EXITERR` |
| 82 | LOGOFF | `.LOGOFF` |
| 84 | LABEL | `.LABEL EXITERR` |
| 86 | LOGOFF | `.LOGOFF` |

## SQL Blocks Analysis

### SQL Block 1 (Lines 42-48)
- **Complexity Score**: 24
- **Has Valid SQL**: ‚úÖ
- **Conversion Successful**: ‚úÖ
- **Syntax Validation**: ‚úÖ Valid
- **Teradata Features**: 1

#### üìù Original Teradata SQL:
```sql
SELECT  CAST(CAST(BTCH_KEY_I AS INTEGER) AS CHAR(10))
         ,CAST(BTCH_RUN_D AS CHAR(10))
        
    FROM %%VTECH%%.UTIL_BTCH_ISAC
  WHERE BTCH_KEY_I = :BTCHKEY;
```

#### ‚ùÑÔ∏è Converted Snowflake SQL:
```sql
SELECT CAST(CAST(BTCH_KEY_I AS INT) AS CHAR(10)), CAST(BTCH_RUN_D AS CHAR(10)) FROM %%VTECH%%.UTIL_BTCH_ISAC WHERE BTCH_KEY_I = :BTCHKEY
```

#### üîç Syntax Validation Details:
- **Valid**: ‚úÖ

#### üéØ Teradata Features Detected:
- Variable substitution

#### ‚ö° Optimized SQL:
```sql
SELECT
  CAST(CAST("util_btch_isac"."btch_key_i" AS INT) AS CHAR(10)) AS "btch_key_i",
  CAST("util_btch_isac"."btch_run_d" AS CHAR(10)) AS "btch_run_d"
FROM "%%vtech%%"."util_btch_isac" AS "util_btch_isac"
WHERE
  "util_btch_isac"."btch_key_i" = :BTCHKEY
```

#### üìä SQL Metadata:
- **Tables**: UTIL_BTCH_ISAC
- **Columns**: BTCH_KEY_I, BTCH_RUN_D
- **Functions**: BTCH_KEY_I, BTCH_RUN_D, CAST(BTCH_KEY_I AS INT)

## Migration Recommendations

### Suggested Migration Strategy
**Simple transformation** - Standard dbt model with table materialization

### DCF Mapping
- **Error Handling**: Convert `.IF ERRORCODE` patterns to DCF error handling macros
- **File Operations**: Replace IMPORT/EXPORT with dbt seeds or external tables
- **Statistics**: Replace COLLECT STATS with Snowflake post-hooks
- **Stored Procedures**: Map CALL statements to DCF stored procedure macros

---

*Generated by BTEQ Parser Service - 2025-08-20 12:39:25*
