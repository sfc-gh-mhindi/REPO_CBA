# BTEQ Analysis Package

This directory contains comprehensive analysis outputs from the BTEQ Parser Service, designed to support the agentic migration solution.

## Directory Structure

```
bteq_dcf/analysis/
├── __init__.py                     # Package initialization
├── README.md                       # This documentation
├── individual/                     # Individual file analyses
│   ├── ACCT_BALN_BKDT_*.md        # Per-file analysis reports
│   ├── DERV_ACCT_PATY_*.md        # Derivation script analyses
│   └── prtf_tech_*.md             # Portfolio tech analyses
└── reports/                        # Comprehensive reports
    ├── bteq_migration_analysis.md  # Human-readable summary
    └── bteq_migration_analysis.xml # Structured XML for LLM processing
```

## Analysis Contents

### Individual Files (`individual/`)
Each markdown file contains:
- **File Overview**: Size, lines, processing status
- **Migration Assessment**: Complexity rating and recommended strategy
- **Control Flow Analysis**: Line-by-line BTEQ control statements
- **SQL Blocks Analysis**: SQLGlot parsing results with complexity metrics
- **Teradata Features**: Detected features requiring conversion
- **Database Objects**: Tables, columns, functions identified
- **Migration Recommendations**: Specific conversion strategies

### Comprehensive Reports (`reports/`)

#### `bteq_migration_analysis.md`
- Executive summary of all 49 BTEQ files
- Aggregate statistics and patterns
- Migration complexity distribution
- Common Teradata features requiring conversion
- Recommended migration strategies by pattern type

#### `bteq_migration_analysis.xml`
- Structured XML format for LLM interactions
- Hierarchical organization of all analysis data
- Machine-readable format for:
  - Classifier Service pattern recognition
  - Mapper Service DCF mapping
  - Generator Service dbt model creation
  - Validator Service quality checks

## Usage for Agentic Solution

### For Human Review
```bash
# View individual file analysis
cat bteq_dcf/analysis/individual/ACCT_BALN_BKDT_ADJ_RULE_ISRT_analysis.md

# View comprehensive summary
cat bteq_dcf/analysis/reports/bteq_migration_analysis.md
```

### For LLM Processing
```python
# Load XML for structured processing
import xml.etree.ElementTree as ET
tree = ET.parse('bteq_dcf/analysis/reports/bteq_migration_analysis.xml')
root = tree.getroot()

# Extract statistics
stats = root.find('summary/statistics')
total_controls = stats.find('total_control_statements').text
total_sql_blocks = stats.find('total_sql_blocks').text
```

## Analysis Statistics

- **Total Files Analyzed**: 49
- **Successfully Processed**: 47 (96% success rate)
- **Control Statements**: 744 total
- **SQL Blocks**: 173 total
- **Unique Teradata Features**: 6 types detected
- **Variable Substitutions**: 167 instances

## Migration Insights

### Control Flow Patterns
- **Error Handling**: 397 `.IF ERRORCODE` statements → DCF error macros
- **Labels**: 93 `.LABEL` statements → dbt pre/post-hooks
- **File Operations**: 67 `.IMPORT/.EXPORT` → dbt external tables
- **Statistics**: 54 `COLLECT STATS` → Remove or Snowflake ANALYZE

### SQL Complexity Distribution
- **Low Complexity** (< 50 nodes): Standard dbt table materialization
- **Medium Complexity** (50-200 nodes): Incremental models with DCF hooks
- **High Complexity** (> 200 nodes): Break into multiple models

### Critical Teradata Features
1. **Variable Substitution** (167×) → dbt variables `{{ var('name') }}`
2. **QUALIFY Clauses** (28×) → Window functions + WHERE clauses
3. **ROW_NUMBER() OVER** (22×) → Direct Snowflake support
4. **ADD_MONTHS Function** (17×) → `DATEADD(MONTH, n, date)`

---
*Generated by BTEQ Parser Service with SQLGlot analysis*
