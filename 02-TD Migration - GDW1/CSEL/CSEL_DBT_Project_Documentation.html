<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README_PDF</title>
  <style>
html {
color: #1a1a1a;
background-color: #fdfdfd;
}
body {
margin: 0 auto;
max-width: 36em;
padding-left: 50px;
padding-right: 50px;
padding-top: 50px;
padding-bottom: 50px;
hyphens: auto;
overflow-wrap: break-word;
text-rendering: optimizeLegibility;
font-kerning: normal;
}
@media (max-width: 600px) {
body {
font-size: 0.9em;
padding: 12px;
}
h1 {
font-size: 1.8em;
}
}
@media print {
html {
background-color: white;
}
body {
background-color: transparent;
color: black;
font-size: 12pt;
}
p, h2, h3 {
orphans: 3;
widows: 3;
}
h2, h3, h4 {
page-break-after: avoid;
}
}
p {
margin: 1em 0;
}
a {
color: #1a1a1a;
}
a:visited {
color: #1a1a1a;
}
img {
max-width: 100%;
}
svg {
height: auto;
max-width: 100%;
}
h1, h2, h3, h4, h5, h6 {
margin-top: 1.4em;
}
h5, h6 {
font-size: 1em;
font-style: italic;
}
h6 {
font-weight: normal;
}
ol, ul {
padding-left: 1.7em;
margin-top: 1em;
}
li > ol, li > ul {
margin-top: 0;
}
blockquote {
margin: 1em 0 1em 1.7em;
padding-left: 1em;
border-left: 2px solid #e6e6e6;
color: #606060;
}
code {
font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
font-size: 85%;
margin: 0;
hyphens: manual;
}
pre {
margin: 1em 0;
overflow: auto;
}
pre code {
padding: 0;
overflow: visible;
overflow-wrap: normal;
}
.sourceCode {
background-color: transparent;
overflow: visible;
}
hr {
border: none;
border-top: 1px solid #1a1a1a;
height: 1px;
margin: 1em 0;
}
table {
margin: 1em 0;
border-collapse: collapse;
width: 100%;
overflow-x: auto;
display: block;
font-variant-numeric: lining-nums tabular-nums;
}
table caption {
margin-bottom: 0.75em;
}
tbody {
margin-top: 0.5em;
border-top: 1px solid #1a1a1a;
border-bottom: 1px solid #1a1a1a;
}
th {
border-top: 1px solid #1a1a1a;
padding: 0.25em 0.5em 0.25em 0.5em;
}
td {
padding: 0.125em 0.5em 0.25em 0.5em;
}
header {
margin-bottom: 4em;
text-align: center;
}
#TOC li {
list-style: none;
}
#TOC ul {
padding-left: 1.3em;
}
#TOC > ul {
padding-left: 0;
}
#TOC a:not(:hover) {
text-decoration: none;
}
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}

ul.task-list[class]{list-style: none;}
ul.task-list li input[type="checkbox"] {
font-size: inherit;
width: 0.8em;
margin: 0 0.8em 0.2em -1.6em;
vertical-align: middle;
}
.display.math{display: block; text-align: center; margin: 0.5rem auto;}

html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
</head>
<body>
<h1 id="csel-dbt-project---snowflake-deployment-guide">CSEL DBT Project
- Snowflake Deployment Guide</h1>
<h2 id="overview">Overview</h2>
<p>The CSEL (Commonwealth Bank Service Layer) project is a data pipeline
implemented using DBT (Data Build Tool) and deployed within Snowflake.
This project processes customer service data, appointments, products,
and department information through a series of sequential
transformations.</p>
<h2 id="project-structure">Project Structure</h2>
<pre><code>CSEL/
â”œâ”€â”€ NPW DBT Project - Modified/          # Main DBT project directory
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ cse_dataload/               # Core data loading models
â”‚   â”‚   â”‚   â”œâ”€â”€ 02processkey/           # Process key generation
â”‚   â”‚   â”‚   â”œâ”€â”€ 04MappingLookupSets/    # Mapping and lookup tables
â”‚   â”‚   â”‚   â”œâ”€â”€ 08extraction/           # Data extraction models
â”‚   â”‚   â”‚   â”œâ”€â”€ 12MappingTransformation/ # Data transformations
â”‚   â”‚   â”‚   â”œâ”€â”€ 14loadtotemp/           # Temporary table loading
â”‚   â”‚   â”‚   â”œâ”€â”€ 16transformdelta/       # Delta transformations
â”‚   â”‚   â”‚   â”œâ”€â”€ 18loadtogdw/           # Final GDW loading
â”‚   â”‚   â”‚   â””â”€â”€ 24processmetadata/      # Process metadata management
â”‚   â”‚   â””â”€â”€ appt_pdct/                  # Appointment product models
â”‚   â”œâ”€â”€ dbt_project.yml                # DBT project configuration
â”‚   â””â”€â”€ profiles.yml                   # Connection profiles
â”œâ”€â”€ NPW DBT - Pre-Installation Scripts/ # Deployment scripts
â”‚   â”œâ”€â”€ NPW04-Execute_DBT_Procedure.sql # Main execution procedure
â”‚   â””â”€â”€ NPW05-Task_Execute_DBT_CSEL.sql # Orchestration task
â””â”€â”€ README.md                          # This file</code></pre>
<h2 id="deployment-architecture">Deployment Architecture</h2>
<h3 id="snowflake-database-structure">1. Snowflake Database
Structure</h3>
<p><strong>SNOWFLAKE ENVIRONMENT ARCHITECTURE:</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            SNOWFLAKE ENVIRONMENT                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    NPD_D12_DMN_GDWMIG Database                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚                        TMP Schema                           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ P_EXECUTE_DBT_CSEL (Stored Procedure)                   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ T_EXECUTE_DBT_CSEL (Scheduled Task)                     â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ GDW1_DBT (DBT Project)                                  â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                NPD_D12_DMN_GDWMIG_IBRG_V Database                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚                  P_V_OUT_001_STD_0 Schema                  â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ DCF_T_EXEC_LOG (Audit Table)                            â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ RUN_STRM_TMPL (Control Table)                           â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚                    DBT Models Output                       â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Materialized Views                                      â”‚    â”‚    â”‚
â”‚  â”‚  â”‚  â€¢ Data Tables                                             â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                        External Systems                             â”‚    â”‚
â”‚  â”‚  â€¢ Snowflake DBT Workspace                                         â”‚    â”‚
â”‚  â”‚  â€¢ wh_usr_npd_d12_gdwmig_001 (Compute Warehouse)                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                         Scheduling                                  â”‚    â”‚
â”‚  â”‚  â€¢ Daily 3 AM Australia/Sydney                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<p><strong>Key Components:</strong> - <strong>Primary Database</strong>:
<code>NPD_D12_DMN_GDWMIG</code> - <strong>Schema</strong>:
<code>TMP</code> - <strong>DBT Project Name</strong>:
<code>GDW1_DBT</code> - <strong>Models Database</strong>:
<code>NPD_D12_DMN_GDWMIG_IBRG_V</code> (materialized views and
tables)</p>
<p><strong>Connection Flow:</strong></p>
<pre><code>Daily 3 AM Scheduler â†’ T_EXECUTE_DBT_CSEL â†’ P_EXECUTE_DBT_CSEL â†’ GDW1_DBT
P_EXECUTE_DBT_CSEL â†’ DCF_T_EXEC_LOG (Audit) + RUN_STRM_TMPL (Control)
GDW1_DBT â†’ Snowflake DBT Workspace + wh_usr_npd_d12_gdwmig_001 Warehouse
GDW1_DBT â†’ Materialized Views + Data Tables in NPD_D12_DMN_GDWMIG_IBRG_V</code></pre>
<h3 id="dbt-project-deployment">2. DBT Project Deployment</h3>
<p>The DBT project is deployed to Snowflake Workspaces using the
following configuration:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># From dbt_project.yml</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;np_projects_commbank_sf_dbt&#39;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">profile</span><span class="kw">:</span><span class="at"> </span><span class="st">&#39;np_projects_commbank_sf_dbt&#39;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">models</span><span class="kw">:</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">np_projects_commbank_sf_dbt</span><span class="kw">:</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">+materialized</span><span class="kw">:</span><span class="at"> view</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">+database</span><span class="kw">:</span><span class="at"> NPD_D12_DMN_GDWMIG_IBRG_V</span></span></code></pre></div>
<h4 id="deployment-steps">Deployment Steps:</h4>
<ol type="1">
<li>Upload the <code>NPW DBT Project - Modified</code> directory to
Snowflake Workspaces</li>
<li>Configure the DBT project to use the
<code>NPD_D12_DMN_GDWMIG.TMP.GDW1_DBT</code> workspace</li>
<li>Deploy the pre-installation scripts to create the execution
infrastructure</li>
</ol>
<h2 id="execution-framework">Execution Framework</h2>
<h3 id="main-execution-procedure">3. Main Execution Procedure</h3>
<p><strong>Location</strong>:
<code>NPW04-Execute_DBT_Procedure.sql</code><br />
<strong>Procedure Name</strong>:
<code>NPD_D12_DMN_GDWMIG.TMP.P_EXECUTE_DBT_CSEL()</code></p>
<p>This stored procedure orchestrates the execution of 18 sequential DBT
model steps:</p>
<p><strong>18-STEP EXECUTION FLOW:</strong></p>
<pre><code>START: P_EXECUTE_DBT_CSEL
    â†“
â”Œâ”€ INITIALIZATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Update Control Tables (RUN_STRM_ABRT_F = &#39;N&#39;, RUN_STRM_ACTV_F = &#39;I&#39;)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€ VALIDATION &amp; SETUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Step 1: processrunstreamstatuscheck â†’ Validate stream processing status  â”‚
â”‚ 3. Step 2: utilprosisacprevloadcheck â†’ Check previous load completion       â”‚
â”‚ 4. Step 3: loadgdwproskeyseq â†’ Load GDW process key sequences               â”‚
â”‚ 5. Step 4: ldmap_cse_pack_pdct_pllkp â†’ Load product mapping lookups         â”‚
â”‚ 6. Step 5: processrunstreamfinishingpoint â†’ Set processing checkpoints      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€ DATA EXTRACTION &amp; TRANSFORMATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Step 6: processrunstreamstatuscheck (with CSE_CPL_BUS_APP variable)      â”‚
â”‚ 8. Step 7: extpl_app â†’ Extract application data                             â”‚
â”‚ 9. Step 8: xfmpl_appfrmext â†’ Transform application data                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€ APPOINTMENT DEPARTMENT PROCESSING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. Step 9: ldtmp_appt_deptrmxfm â†’ Load appointment department temp data    â”‚
â”‚ 11. Step 10: dltappt_deptfrmtmp_appt_dept â†’ Delta processing for appt depts â”‚
â”‚ 12. Step 11: ldapptdeptupd â†’ Update appointment department data             â”‚
â”‚ 13. Step 12: ldapptdeptins â†’ Insert new appointment department data         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€ APPOINTMENT PRODUCT PROCESSING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 14. Step 13: ldtmp_appt_pdctfrmxfm â†’ Load appointment product temp data     â”‚
â”‚ 15. Step 14: dltappt_pdctfrmtmp_appt_pdct â†’ Delta processing for appt prods â”‚
â”‚ 16. Step 15: ldapptpdctupd â†’ Update appointment product data                â”‚
â”‚ 17. Step 16: ldapptpdctins â†’ Insert new appointment product data            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€ FINAL DEPARTMENT-APPOINTMENT PROCESSING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 18. Step 17: ldapptdeptupd (with dept_appt target table)                    â”‚
â”‚ 19. Step 18: ldapptdeptins (with dept_appt target table)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€ SUCCESS COMPLETION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SUCCESS: Log completion &amp; Return JSON result                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ERROR HANDLING: Any step failure â†’ Log error details &amp; Return failure JSON</code></pre>
<h4 id="key-features">Key Features:</h4>
<ul>
<li><strong>Error Handling</strong>: Each step includes comprehensive
error handling with detailed logging</li>
<li><strong>Progress Tracking</strong>: JSON-based result tracking with
step-by-step status</li>
<li><strong>Rollback Capability</strong>: Failed steps prevent further
execution and log detailed error information</li>
<li><strong>Flexible Execution</strong>: Some steps include dynamic
variables for different target tables</li>
</ul>
<h3 id="task-orchestration">4. Task Orchestration</h3>
<p><strong>Location</strong>:
<code>NPW05-Task_Execute_DBT_CSEL.sql</code><br />
<strong>Task Name</strong>:
<code>NPD_D12_DMN_GDWMIG.TMP.T_EXECUTE_DBT_CSEL</code></p>
<h4 id="task-configuration">Task Configuration:</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CREATE</span> <span class="kw">OR</span> <span class="kw">REPLACE</span> TASK NPD_D12_DMN_GDWMIG.TMP.T_EXECUTE_DBT_CSEL</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    WAREHOUSE <span class="op">=</span> wh_usr_npd_d12_gdwmig_001</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    SCHEDULE <span class="op">=</span> <span class="st">&#39;USING CRON 0 3 * * * Australia/Sydney&#39;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    ALLOW_OVERLAPPING_EXECUTION <span class="op">=</span> <span class="kw">FALSE</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="kw">AS</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">CALL</span> NPD_D12_DMN_GDWMIG.TMP.P_EXECUTE_DBT_CSEL();</span></code></pre></div>
<ul>
<li><strong>Schedule</strong>: Daily execution at 3:00 AM
Australia/Sydney timezone</li>
<li><strong>Warehouse</strong>: Dedicated warehouse for consistent
resource allocation</li>
<li><strong>Overlap Prevention</strong>: Ensures only one instance runs
at a time</li>
</ul>
<h2 id="monitoring-and-troubleshooting">Monitoring and
Troubleshooting</h2>
<h3 id="monitoring-methods">5. Monitoring Methods</h3>
<p><strong>CSEL DBT EXECUTION MONITORING OVERVIEW:</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MONITORING ARCHITECTURE                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚                      P_EXECUTE_DBT_CSEL Execution                          â”‚
â”‚                                    â”‚                                       â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚          â”‚                         â”‚                         â”‚               â”‚
â”‚          â–¼                         â–¼                         â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ 1. DBT WORKSPACE â”‚     â”‚ 2. QUERY HISTORY â”‚     â”‚ 3. AUDIT TABLE   â”‚     â”‚
â”‚  â”‚   MONITORING     â”‚     â”‚    MONITORING    â”‚     â”‚   MONITORING     â”‚     â”‚
â”‚  â”‚                  â”‚     â”‚                  â”‚     â”‚                  â”‚     â”‚
â”‚  â”‚ â€¢ Snowflake DBT  â”‚     â”‚ â€¢ Query History  â”‚     â”‚ â€¢ DCF_T_EXEC_LOG â”‚     â”‚
â”‚  â”‚   Workspace      â”‚     â”‚   Analysis       â”‚     â”‚   Audit Table    â”‚     â”‚
â”‚  â”‚ â€¢ SHOW TASKS     â”‚     â”‚ â€¢ TASK_HISTORY   â”‚     â”‚ â€¢ Status Queries â”‚     â”‚
â”‚  â”‚   Commands       â”‚     â”‚   Function       â”‚     â”‚ â€¢ Recent/Failed  â”‚     â”‚
â”‚  â”‚                  â”‚     â”‚ â€¢ RESULT_SCAN    â”‚     â”‚   Executions     â”‚     â”‚
â”‚  â”‚                  â”‚     â”‚   Function       â”‚     â”‚                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚            â”‚                        â”‚                        â”‚              â”‚
â”‚            â–¼                        â–¼                        â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Real-time       â”‚     â”‚  Execution       â”‚     â”‚  Detailed Logs   â”‚     â”‚
â”‚  â”‚  Status          â”‚     â”‚  History         â”‚     â”‚  Step-by-step    â”‚     â”‚
â”‚  â”‚  Active          â”‚     â”‚  Performance     â”‚     â”‚  Status          â”‚     â”‚
â”‚  â”‚  Executions      â”‚     â”‚  Metrics         â”‚     â”‚                  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h4 id="a.-dbt-project-monitoring">A. DBT Project Monitoring</h4>
<p>Monitor execution directly from the Snowflake DBT Workspace:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- View active DBT executions</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>SHOW TASKS <span class="kw">IN</span> <span class="kw">SCHEMA</span> NPD_D12_DMN_GDWMIG.TMP;</span></code></pre></div>
<h4 id="b.-query-history-monitoring">B. Query History Monitoring</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Monitor task execution history</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> QUERY_ID, STATE, QUERY_START_TIME, <span class="op">*</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> <span class="kw">TABLE</span>(NPD_D12_DMN_GDWMIG.INFORMATION_SCHEMA.TASK_HISTORY(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    TASK_NAME <span class="op">=&gt;</span> <span class="st">&#39;T_EXECUTE_DBT_CSEL&#39;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>)) A</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> SCHEMA_NAME <span class="op">=</span> <span class="st">&#39;TMP&#39;</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> A.QUERY_START_TIME <span class="kw">DESC</span>;</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">-- View specific execution results</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> <span class="kw">TABLE</span>(RESULT_SCAN(<span class="st">&#39;&lt;QUERY_ID&gt;&#39;</span>));</span></code></pre></div>
<h4 id="c.-audit-table-monitoring">C. Audit Table Monitoring</h4>
<p><strong>Primary Logging Table</strong>:
<code>NPD_D12_DMN_GDWMIG_IBRG_V.P_V_OUT_001_STD_0.DCF_T_EXEC_LOG</code></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Monitor recent executions</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    PRCS_NAME,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    STRM_NAME,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    STEP_STATUS,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    MESSAGE_TYPE,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    MESSAGE_TEXT,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    CREATED_TS,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    SESSION_ID,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    WAREHOUSE_NAME</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> NPD_D12_DMN_GDWMIG_IBRG_V.P_V_OUT_001_STD_0.DCF_T_EXEC_LOG</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> PRCS_NAME <span class="op">=</span> <span class="st">&#39;P_EXECUTE_DBT_CSEL&#39;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> CREATED_TS <span class="kw">DESC</span>;</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">-- Monitor failed executions</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> NPD_D12_DMN_GDWMIG_IBRG_V.P_V_OUT_001_STD_0.DCF_T_EXEC_LOG</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> PRCS_NAME <span class="op">=</span> <span class="st">&#39;P_EXECUTE_DBT_CSEL&#39;</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">AND</span> STEP_STATUS <span class="op">=</span> <span class="st">&#39;FAILED&#39;</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> CREATED_TS <span class="kw">DESC</span>;</span></code></pre></div>
<h3 id="execution-results">6. Execution Results</h3>
<p>The procedure returns a JSON object containing: -
<code>total_steps</code>: Number of completed steps -
<code>final_status</code>: SUCCESS, FAILED, or EXCEPTION -
<code>completed_at</code>: Timestamp of completion (for successful runs)
- <code>failed_at_step</code>: Step number where failure occurred (for
failed runs) - <code>steps</code>: Array of individual step results with
timestamps and status</p>
<h4 id="example-success-result">Example Success Result:</h4>
<div class="sourceCode" id="cb11"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;total_steps&quot;</span><span class="fu">:</span> <span class="dv">18</span><span class="fu">,</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;final_status&quot;</span><span class="fu">:</span> <span class="st">&quot;SUCCESS&quot;</span><span class="fu">,</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;completed_at&quot;</span><span class="fu">:</span> <span class="st">&quot;2024-01-15 03:45:32.123&quot;</span><span class="fu">,</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;steps&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">...</span><span class="ot">]</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h4 id="example-failure-result">Example Failure Result:</h4>
<div class="sourceCode" id="cb12"><pre class="sourceCode json"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;total_steps&quot;</span><span class="fu">:</span> <span class="dv">7</span><span class="fu">,</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;final_status&quot;</span><span class="fu">:</span> <span class="st">&quot;FAILED&quot;</span><span class="fu">,</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;failed_at_step&quot;</span><span class="fu">:</span> <span class="dv">7</span><span class="fu">,</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&quot;steps&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="er">...</span><span class="ot">]</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="maintenance-and-operations">Maintenance and Operations</h2>
<h3 id="manual-execution">7. Manual Execution</h3>
<p>To manually execute the procedure:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">CALL</span> NPD_D12_DMN_GDWMIG.TMP.P_EXECUTE_DBT_CSEL();</span></code></pre></div>
<h3 id="task-management">8. Task Management</h3>
<div class="sourceCode" id="cb14"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Suspend the task</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> TASK NPD_D12_DMN_GDWMIG.TMP.T_EXECUTE_DBT_CSEL <span class="kw">SUSPEND</span>;</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Resume the task</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> TASK NPD_D12_DMN_GDWMIG.TMP.T_EXECUTE_DBT_CSEL <span class="kw">RESUME</span>;</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">-- Modify task schedule</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="kw">ALTER</span> TASK NPD_D12_DMN_GDWMIG.TMP.T_EXECUTE_DBT_CSEL </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> SCHEDULE <span class="op">=</span> <span class="st">&#39;USING CRON 0 4 * * * Australia/Sydney&#39;</span>;</span></code></pre></div>
<h3 id="control-tables">9. Control Tables</h3>
<p>The procedure updates control tables to manage stream processing:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Stream control update (executed at procedure start)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">UPDATE</span> NPD_D12_DMN_GDWMIG_IBRG_V.P_V_OUT_001_STD_0.RUN_STRM_TMPL </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="kw">SET</span> RUN_STRM_ABRT_F <span class="op">=</span> <span class="st">&#39;N&#39;</span>, RUN_STRM_ACTV_F <span class="op">=</span> <span class="st">&#39;I&#39;</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> RUN_STRM_C <span class="kw">IN</span> (<span class="st">&#39;CSE_L4_PRE_PROC&#39;</span>,<span class="st">&#39;CSE_CPL_BUS_APP&#39;</span>) </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">AND</span> SYST_C <span class="op">=</span> <span class="st">&#39;CSEL4&#39;</span>;</span></code></pre></div>
<h2 id="database-structure-model-relationships">Database Structure &amp;
Model Relationships</h2>
<p><strong>DATABASE STRUCTURE AND RELATIONSHIPS:</strong></p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATABASE STRUCTURE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     NPD_D12_DMN_GDWMIG                             â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚                    TMP Schema                             â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ“‹ P_EXECUTE_DBT_CSEL (Stored Procedure)                â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  â° T_EXECUTE_DBT_CSEL (Scheduled Task)                  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ”§ GDW1_DBT (DBT Project)                               â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  NPD_D12_DMN_GDWMIG_IBRG_V                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚                P_V_OUT_001_STD_0                         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ“Š DCF_T_EXEC_LOG (Audit Logs)                          â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  âš™ï¸ RUN_STRM_TMPL (Control Table)                        â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚                                                                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚                   Model Outputs                          â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ”‘ 02processkey (Process Keys)                          â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ—ºï¸ 04MappingLookupSets (Lookups)                       â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ“¥ 08extraction (Data Extraction)                       â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ”„ 12MappingTransformation (Transformations)            â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ“ 14loadtotemp (Temp Tables)                           â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ”º 16transformdelta (Delta Processing)                  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ“¤ 18loadtogdw (Final Load)                             â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ“‹ 24processmetadata (Metadata)                         â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  ğŸ“… appt_pdct (Appointments)                             â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                             â”‚
â”‚  EXECUTION FLOW:                                                            â”‚
â”‚  Task â†’ Procedure â†’ DBT Project â†’ Model Outputs                            â”‚
â”‚  Procedure â†’ Audit Logs &amp; Control Tables                                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<p><strong>Model Categories:</strong> - <strong>ğŸ”‘ Process Keys
(02processkey)</strong>: Generate unique process identifiers -
<strong>ğŸ—ºï¸ Mapping Lookups (04MappingLookupSets)</strong>: Reference
tables for data mapping - <strong>ğŸ“¥ Data Extraction
(08extraction)</strong>: Source data extraction from external systems -
<strong>ğŸ”„ Transformations (12MappingTransformation)</strong>: Business
logic transformations - <strong>ğŸ“ Temp Tables (14loadtotemp)</strong>:
Staging area for processed data - <strong>ğŸ”º Delta Processing
(16transformdelta)</strong>: Change data capture processing - <strong>ğŸ“¤
Final Load (18loadtogdw)</strong>: Load processed data to target tables
- <strong>ğŸ“‹ Metadata (24processmetadata)</strong>: Process execution
metadata - <strong>ğŸ“… Appointments (appt_pdct)</strong>: Appointment and
product specific models</p>
<h2 id="troubleshooting-guide">Troubleshooting Guide</h2>
<h3 id="common-issues">Common Issues:</h3>
<ol type="1">
<li><strong>Step Failure</strong>: Check the <code>DCF_T_EXEC_LOG</code>
table for detailed error messages</li>
<li><strong>Task Not Running</strong>: Verify task status with
<code>SHOW TASKS</code> and check warehouse availability</li>
<li><strong>DBT Model Errors</strong>: Review individual model logs in
the DBT workspace</li>
<li><strong>Permission Issues</strong>: Ensure proper database and
schema access rights</li>
</ol>
<h3 id="support-contacts">Support Contacts:</h3>
<ul>
<li><strong>Database Team</strong>: For Snowflake infrastructure
issues</li>
<li><strong>ETL Team</strong>: For data processing and transformation
issues</li>
<li><strong>Business Team</strong>: For data validation and business
logic questions</li>
</ul>
<hr />
<p><em>Last Updated: [Current Date]</em> <em>Version: 1.0</em></p>
</body>
</html>
